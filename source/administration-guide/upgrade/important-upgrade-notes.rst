Important Upgrade Notes
=======================

.. include:: ../../_static/badges/all-commercial.rst
  :start-after: :nosearch:

.. include:: ../../product-overview/common-esr-support-rst.rst

We recommend reviewing the `additional upgrade notes <#additional-upgrade-notes>`__ at the bottom of this page.

+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| If you're upgrading                                | Then...                                                                                                                                                          |
| from a version earlier than...                     |                                                                                                                                                                  |
+====================================================+==================================================================================================================================================================+
| v11.4                                              | Photoshop Document (PSD) files are now no longer inline previewed, they are treated as regular file attachments.                                                 |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Added two new tables, ``Recaps`` and ``RecapChannels``. The migrations are fully                                                                                 |
|                                                    | backwards-compatible and no database downtime is expected for this upgrade. The SQL queries included are:                                                        |
|                                                    |                                                                                                                                                                  |
|                                                    | .. code-block:: sql                                                                                                                                              |
|                                                    |                                                                                                                                                                  | 
|                                                    |   -- Recaps table: stores recap metadata                                                                                                                         |
|                                                    |   CREATE TABLE IF NOT EXISTS Recaps (                                                                                                                            |
|                                                    |       Id VARCHAR(26) PRIMARY KEY,                                                                                                                                |
|                                                    |       UserId VARCHAR(26) NOT NULL,                                                                                                                               |
|                                                    |       Title VARCHAR(255) NOT NULL,                                                                                                                               |
|                                                    |       CreateAt BIGINT NOT NULL,                                                                                                                                  |
|                                                    |       UpdateAt BIGINT NOT NULL,                                                                                                                                  |
|                                                    |       DeleteAt BIGINT NOT NULL,                                                                                                                                  |
|                                                    |       TotalMessageCount INT NOT NULL,                                                                                                                            |
|                                                    |       Status VARCHAR(32) NOT NULL,                                                                                                                               |
|                                                    |       ReadAt BIGINT DEFAULT 0 NOT NULL,                                                                                                                          |
|                                                    |       BotID VARCHAR(26) DEFAULT '' NOT NULL                                                                                                                      |
|                                                    |   );                                                                                                                                                             |
|                                                    |                                                                                                                                                                  |   
|                                                    |   CREATE INDEX IF NOT EXISTS idx_recaps_user_id ON Recaps(UserId);                                                                                               |
|                                                    |   CREATE INDEX IF NOT EXISTS idx_recaps_create_at ON Recaps(CreateAt);                                                                                           |
|                                                    |   CREATE INDEX IF NOT EXISTS idx_recaps_user_id_delete_at ON Recaps(UserId, DeleteAt);                                                                           |
|                                                    |   CREATE INDEX IF NOT EXISTS idx_recaps_user_id_read_at ON Recaps(UserId, ReadAt);                                                                               |
|                                                    |   CREATE INDEX IF NOT EXISTS idx_recaps_bot_id ON Recaps(BotID);                                                                                                 |
|                                                    |                                                                                                                                                                  | 
|                                                    |   -- RecapChannels table: stores per-channel summaries                                                                                                           |
|                                                    |   CREATE TABLE IF NOT EXISTS RecapChannels (                                                                                                                     |
|                                                    |       Id VARCHAR(26) PRIMARY KEY,                                                                                                                                |
|                                                    |       RecapId VARCHAR(26) NOT NULL,                                                                                                                              |
|                                                    |       ChannelId VARCHAR(26) NOT NULL,                                                                                                                            |
|                                                    |       ChannelName VARCHAR(64) NOT NULL,                                                                                                                          |
|                                                    |       Highlights TEXT,                                                                                                                                           |
|                                                    |       ActionItems TEXT,                                                                                                                                          |
|                                                    |       SourcePostIds TEXT,                                                                                                                                        |
|                                                    |       CreateAt BIGINT NOT NULL,                                                                                                                                  |
|                                                    |       FOREIGN KEY (RecapId) REFERENCES Recaps(Id) ON DELETE CASCADE                                                                                              |
|                                                    |   );                                                                                                                                                             |
|                                                    |                                                                                                                                                                  |    
|                                                    |   CREATE INDEX IF NOT EXISTS idx_recap_channels_recap_id ON RecapChannels(RecapId);                                                                              |
|                                                    |   CREATE INDEX IF NOT EXISTS idx_recap_channels_channel_id ON RecapChannels(ChannelId);                                                                          |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v11.3                                              | Starting in v11.3.1, photoshop Document (PSD) files are now no longer inline previewed, they are treated as regular file attachments.                            |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Added schema changes in the form of a new tables (``ReadReceipts`` and ``TemporaryPosts``) that aggregate user attributes into a separate table. Added ``Type``  |
|                                                    | field for both ``Drafts`` and ``ScheduledPosts``. A previous version of Mattermost can run with the new schema changes. The migrations are fully                 |
|                                                    | backwards-compatible and no database downtime is expected for this upgrade. The SQL queries included are:                                                        |
|                                                    |                                                                                                                                                                  | 
|                                                    | .. code-block:: sql                                                                                                                                              |
|                                                    |                                                                                                                                                                  | 
|                                                    |   CREATE TABLE IF NOT EXISTS ReadReceipts (                                                                                                                      |
|                                                    |       PostId VARCHAR(26) NOT NULL,                                                                                                                               |
|                                                    |       UserId VARCHAR(26) NOT NULL,                                                                                                                               |
|                                                    |       ExpireAt bigint NOT NULL,                                                                                                                                  |
|                                                    |       PRIMARY KEY (PostId, UserId)                                                                                                                               |
|                                                    |   );                                                                                                                                                             |
|                                                    |                                                                                                                                                                  | 
|                                                    |   CREATE INDEX IF NOT EXISTS idx_read_receipts_post_id ON ReadReceipts(PostId);                                                                                  |
|                                                    |   CREATE INDEX IF NOT EXISTS idx_read_receipts_user_id_post_id_expire_at ON ReadReceipts(UserId, PostId, ExpireAt);                                              |
|                                                    |                                                                                                                                                                  | 
|                                                    |   CREATE TABLE IF NOT EXISTS TemporaryPosts (                                                                                                                    |
|                                                    |       PostId VARCHAR(26) PRIMARY KEY,                                                                                                                            |
|                                                    |       Type VARCHAR(26) NOT NULL,                                                                                                                                 |
|                                                    |       ExpireAt BIGINT NOT NULL,                                                                                                                                  |
|                                                    |       Message VARCHAR(65535),                                                                                                                                    |
|                                                    |       FileIds VARCHAR(300)                                                                                                                                       |
|                                                    |   );                                                                                                                                                             |
|                                                    |                                                                                                                                                                  |
|                                                    |   CREATE INDEX IF NOT EXISTS idx_temporary_posts_expire_at ON TemporaryPosts(expireat);                                                                          |
|                                                    |                                                                                                                                                                  |
|                                                    |   ALTER TABLE drafts ADD COLUMN IF NOT EXISTS Type text;                                                                                                         |
|                                                    |   ALTER TABLE scheduledposts ADD COLUMN IF NOT EXISTS Type text;                                                                                                 |             
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Added a new ``translations`` table, two new columns (``channels.autotranslation``, ``channelmembers.autotranslation)``, and four new indexes. The migrations are |
|                                                    | fully backwards-compatible and there are no table rewrites. < 1 second of downtime is required. Zero downtime is possible when using                             |
|                                                    | ``CREATE INDEX CONCURRENTLY`` before upgrading for true zero-downtime upgrade. Standard upgrade is safe for all instance sizes; no special manual steps required |
|                                                    | unless zero-downtime is critical. The SQL queries for absolute zero downtime are:                                                                                |
|                                                    |                                                                                                                                                                  | 
|                                                    | .. code-block:: sql                                                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    |  CREATE INDEX CONCURRENTLY IF NOT EXISTS                                                                                                                         |
|                                                    |  idx_channelmembers_autotranslation_enabled                                                                                                                      |
|                                                    |     ON channelmembers (channelid)                                                                                                                                |
|                                                    |     WHERE autotranslation = true;                                                                                                                                |
|                                                    |                                                                                                                                                                  | 
|                                                    |  CREATE INDEX CONCURRENTLY IF NOT EXISTS                                                                                                                         |
|                                                    |  idx_channels_autotranslation_enabled                                                                                                                            |
|                                                    |     ON channels (id)                                                                                                                                             |
|                                                    |     WHERE autotranslation = true;                                                                                                                                |
|                                                    |                                                                                                                                                                  | 
|                                                    |  CREATE INDEX CONCURRENTLY IF NOT EXISTS                                                                                                                         |
|                                                    |  idx_users_id_locale                                                                                                                                             |
|                                                    |     ON users (id, locale);                                                                                                                                       |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Beginning in Mattermost v11.3, some plugins that register a Right Hand Sidebar (RHS) component using ``registerRightHandSidebarComponent`` will need to          |
|                                                    | implement additional code to support RHS popouts if their RHS component relies on plugin-specific state. See                                                     |
|                                                    | `this forum post <https://forum.mattermost.com/t/rhs-popout-support-for-plugins/25626>`__ for full details.                                                      |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v11.2                                              | Starting in v11.2.3, photoshop Document (PSD) files are now no longer inline previewed, they are treated as regular file attachments.                            |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Added a new column to the ``OAuthApps`` table called ``isdynamicallyregistered``. It has a default value of ``false``. Also added three new columns to the       |
|                                                    | ``OAuthAuthData`` table called ``resource``, ``codechallenge`` and ``codechallengemethod``. All columns default to ``‘’``. Also added a new column to the        |
|                                                    | ``OAuthAccessData`` table called ``audience``. It has a default value of ``‘’``. The migrations are fully backwards-compatible and no database downtime is       |
|                                                    | expected for this upgrade. The tables take an ``ACCESS EXCLUSIVE LOCK``, however it is only to add/remove the metadata. The command returns instantly.           |
|                                                    | The SQL queries included are:                                                                                                                                    |
|                                                    |                                                                                                                                                                  |
|                                                    | .. code-block:: sql                                                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    |   ALTER TABLE oauthapps ADD COLUMN IF NOT EXISTS isdynamicallyregistered BOOLEAN DEFAULT FALSE;                                                                  |
|                                                    |                                                                                                                                                                  |
|                                                    |   ALTER TABLE oauthauthdata ADD COLUMN IF NOT EXISTS codechallenge varchar(128) DEFAULT '';                                                                      |
|                                                    |                                                                                                                                                                  |
|                                                    |   ALTER TABLE oauthauthdata ADD COLUMN IF NOT EXISTS codechallengemethod varchar(10) DEFAULT '';                                                                 |
|                                                    |                                                                                                                                                                  |
|                                                    |   ALTER TABLE oauthaccessdata ADD COLUMN IF NOT EXISTS audience varchar(512) DEFAULT '';                                                                         |
|                                                    |                                                                                                                                                                  |
|                                                    |   ALTER TABLE oauthauthdata ADD COLUMN IF NOT EXISTS resource varchar(512) DEFAULT '';                                                                           |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v11.1                                              | The version of React used by the Mattermost web app has been updated from React 17 to React 18. See more details in                                              |
|                                                    | `this forum post <https://forum.mattermost.com/t/upgrading-the-mattermost-web-app-to-react-18-v11/25000>`__.                                                     |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Added three new tables, ``ContentFlaggingCommonReviewers``, ``ContentFlaggingTeamSettings``, and ``ContentFlaggingTeamReviewers`` for storing Data Spillage      |
|                                                    | settings. Added an index on ``ContentFlaggingTeamReviewers`` table to optimize fetching the team settings. The migrations are fully backwards-compatible. No     |
|                                                    | table locks or existing operations on the table are impacted by this upgrade. Zero downtime is expected when upgrading to this release. The SQL queries          |
|                                                    | included are:                                                                                                                                                    |
|                                                    |                                                                                                                                                                  |
|                                                    | .. code-block:: sql                                                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    |   CREATE TABLE IF NOT EXISTS ContentFlaggingCommonReviewers (                                                                                                    |
|                                                    |       UserId VARCHAR(26) PRIMARY KEY                                                                                                                             |
|                                                    |   );                                                                                                                                                             |
|                                                    |                                                                                                                                                                  |
|                                                    |   CREATE TABLE IF NOT EXISTS ContentFlaggingTeamSettings (                                                                                                       |
|                                                    |       TeamId VARCHAR(26) PRIMARY KEY,                                                                                                                            |
|                                                    |       Enabled BOOLEAN                                                                                                                                            |
|                                                    |   );                                                                                                                                                             |
|                                                    |                                                                                                                                                                  |
|                                                    |   CREATE TABLE IF NOT EXISTS ContentFlaggingTeamReviewers (                                                                                                      |
|                                                    |       TeamId VARCHAR(26),                                                                                                                                        |
|                                                    |       UserId VARCHAR(26),                                                                                                                                        |
|                                                    |       PRIMARY KEY (TeamId, UserId)                                                                                                                               |
|                                                    |   );                                                                                                                                                             |
|                                                    |                                                                                                                                                                  |
|                                                    |   CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_contentflaggingteamreviewers_userid ON ContentFlaggingTeamReviewers (userid);                                      |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v11.0                                              | GitLab SSO has been deprecated from Team Edition. Deployments using GitLab SSO can remain on v10.11 ESR (with 12 months of security updates) while transitioning |
|                                                    | to our new free offering Mattermost Entry, or can explore commercial/nonprofit options. See more details in                                                      |
|                                                    | `this forum post <https://forum.mattermost.com/t/mattermost-v11-changes-in-free-offerings/25126>`__.                                                             |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | The ``TeamSettings.ExperimentalViewArchivedChannels`` setting has been deprecated. Archived channels will always be accessible, subject to normal channel        |
|                                                    | membership. The server will fail to start if this setting is set to ``false``. To deny access to archived channels, mark them as private and remove affected     |
|                                                    | channel members. See more details in `this forum post <https://forum.mattermost.com/t/viewing-accessing-archived-channels-v11/22626>`__.                         |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Playbooks has stopped working for Team Edition. Entry, Professional, Enterprise, and Enterprise Advanced plans are automatically upgraded to Playbooks v2        |
|                                                    | with no expected downtime. See more details in `this forum post <https://forum.mattermost.com/t/clarification-and-update-on-the-playbooks-plugin-v11/25192>`__.  |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Experimental Bleve Search functionality has been retired. If Bleve is enabled, search will not work until ``DisableDatabaseSearch`` is set to ``false``. See     |
|                                                    | more details in `this forum post <https://forum.mattermost.com/t/transitioning-from-bleve-search-in-mattermost-v11/22982>`__.                                    |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Support for MySQL has ended. Our `Migration Guide <https://docs.mattermost.com/deployment-guide/postgres-migration.html>`__ outlines the steps, tools and        |
|                                                    | support available for migrating to PostgreSQL. See more details in `this forum post <https://forum.mattermost.com/t/transition-to-postgresql/19551>`__.          |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | The ``registerPostDropdownMenuComponent`` hook in the web app’s plugin API has been removed in favour of ``registerPostDropdownMenuAction``. See more details in |
|                                                    | `this forum post <https://forum.mattermost.com/t/deprecating-a-post-dropdown-menu-component-plugin-api-v11/25001>`__.                                            |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | The web app is no longer exposing the `Styled Components <https://styled-components.com/>`__ dependency for use by web app plugins. See more details in          |
|                                                    | `this forum post <https://forum.mattermost.com/t/removing-styled-components-export-for-web-app-plugins-v11/25002>`__.                                            |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Omnibus support has been deprecated. The last ``mattermost-omnibus`` release was v10.12. See more details in                                                     |
|                                                    | `this forum post <https://forum.mattermost.com/t/mattermost-omnibus-to-reach-end-of-life-v11/25175>`__.                                                          |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Deprecated ``include_removed_members`` option in ``api/v4/ldap/sync`` has been removed. Admins can use the LDAP setting ``ReAddRemovedMembers``.                 |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Customers that have the NPS plugin enabled can remove it as it no longer sends the feedback over through telemetry.                                              |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Format query parameter requirement in the ``/api/v4/config/client`` endpoint has been deprecated.                                                                |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Removed deprecated mmctl commands and flags:                                                                                                                     |
|                                                    |                                                                                                                                                                  |
|                                                    |     - ``channel add`` - use ``channel users add``                                                                                                                |
|                                                    |     - ``channel remove`` - use ``channel users remove``                                                                                                          |
|                                                    |     - ``channel restore`` - use ``channel unarchive``                                                                                                            |
|                                                    |     - ``channel make-private`` - use ``channel modify --private``                                                                                                |
|                                                    |     - ``command delete`` - use ``command archive``                                                                                                               |
|                                                    |     - ``permissions show`` - use ``permissions role show``                                                                                                       |
|                                                    |     - ``mmctl user email`` - use ``mmctl user edit email``                                                                                                       |
|                                                    |     - ``mmctl user username`` - use ``mmctl user edit username``                                                                                                 |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Experimental certificate-based authentication feature has been removed. ``ExperimentalSettings.ClientSideCertEnable`` must be ``false`` to start the server.     |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Added logic to migrate the password hashing method from bcrypt to PBKDF2. The migration will happen progressively, migrating the password of a user as soon      |
|                                                    | as they enter it; e.g. when logging in or when double-checking their password for any sensitive action. There is an edge case where users might                  |
|                                                    | get locked out of their account: if a server upgrades to v11 and user A logs in (i.e., they need to enter their password), and then the server downgrades        |
|                                                    | to v10.12 or previous, user A will no longer be able to log in. In this case, admins will need to manually reset the password of such users, through the         |
|                                                    | system console or through the                                                                                                                                    |
|                                                    | `mmctl user reset-password [users] <https://docs.mattermost.com/administration-guide/manage/mmctl-command-line-tool.html#mmctl-user-reset-password>`__ command.  |
|                                                    | The new password hashing method is more CPU-intensive. Admins of servers with password-based login should monitor the performance on periods where many users    |
|                                                    | log in at the same time.                                                                                                                                         |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | ``/api/v4/teams/{team_id}/channels/search_archived`` has been deprecated in favour of ``/api/v4/channels/search`` with the deleted parameter.                    |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Changed default database connection pool settings: changed ``MaxOpenConns`` from 300 to 100 and ``MaxIdleConns`` from 20 to 50, establishing a healthier 2:1     |
|                                                    | ratio for better database connection management.                                                                                                                 |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Separate notification log file has been deprecated. If admins want to continue using a separate log file for notification logs, they can use the                 |
|                                                    | ``AdvancedLoggingJSON`` configuration. An example configuration to use is:                                                                                       |
|                                                    |                                                                                                                                                                  |
|                                                    | .. code-block:: sh                                                                                                                                               |
|                                                    |                                                                                                                                                                  |
|                                                    |   {                                                                                                                                                              |
|                                                    |     "LogSettings": {                                                                                                                                             |
|                                                    |       "AdvancedLoggingJSON": {                                                                                                                                   |
|                                                    |         "notifications_file": {                                                                                                                                  |
|                                                    |           "type": "file",                                                                                                                                        |
|                                                    |           "format": "json",                                                                                                                                      |
|                                                    |           "levels": [                                                                                                                                            |
|                                                    |               {"id": 300, "name": "NotificationError"},                                                                                                          |
|                                                    |               {"id": 301, "name": "NotificationWarn"},                                                                                                           |
|                                                    |               {"id": 302, "name": "NotificationInfo"},                                                                                                           |
|                                                    |               {"id": 303, "name": "NotificationDebug"},                                                                                                          |
|                                                    |               {"id": 304, "name": "NotificationTrace"}                                                                                                           |
|                                                    |           ],                                                                                                                                                     |
|                                                    |           "options": {                                                                                                                                           |
|                                                    |               "filename": "notifications.log",                                                                                                                   |
|                                                    |               "max_size": 100,                                                                                                                                   |
|                                                    |               "max_age": 0,                                                                                                                                      |
|                                                    |               "max_backups": 0,                                                                                                                                  |
|                                                    |               "compress": true                                                                                                                                   |
|                                                    |           },                                                                                                                                                     |
|                                                    |           "maxqueuesize": 1000                                                                                                                                   |
|                                                    |         }                                                                                                                                                        |
|                                                    |       }                                                                                                                                                          |
|                                                    |     }                                                                                                                                                            |
|                                                    |   }                                                                                                                                                              |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Stopped supporting manually installed plugins as per https://forum.mattermost.com/t/deprecation-notice-manual-plugin-deployment/21192.                           |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Support for PostgreSQL v13 has been removed. The new minimum PostgreSQL version is v14+. See the                                                                 |
|                                                    | `PostgreSQL version policy <https://docs.mattermost.com/deployment-guide/software-hardware-requirements.html#minimum-postgresql-database-support-policy>`__      |
|                                                    | documentation for details.                                                                                                                                       |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v10.12                                             | There are no important upgrade notes in v10.12 release.                                                                                                          |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v10.11                                             | Starting in v10.11.11, photoshop Document (PSD) files are now no longer inline previewed, they are treated as regular file attachments.                          |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Mattermost v10.11.4 introduces a new API endpoint ``/api/v4/users/login/sso/code-exchange`` as part of security enhancements to the SSO authentication flow.     |
|                                                    | Customer using SSO (e.g. with SAML) should ensure network configurations allow traffic to this endpoint.                                                         |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v10.10                                             | Added a new column ``DefaultCategoryName`` to the ``Channels`` table. This is nullable and stores a category name to be added/created when new users join a      |
|                                                    | channel. This is only used if the ``ExperimentalChannelCategorySetting`` is enabled. The migrations are fully backwards-compatible and no table locks or         |
|                                                    | existing operations on the table are impacted by this upgrade. Zero downtime is expected when upgrading to this release. The SQL queries included are:           |
|                                                    |                                                                                                                                                                  |
|                                                    | PostgreSQL:                                                                                                                                                      |
|                                                    | https://github.com/mattermost/mattermost/blob/release-10.10/server/channels/db/migrations/postgres/000138_add_default_category_name_to_channel.down.sql and      |
|                                                    | https://github.com/mattermost/mattermost/blob/release-10.10/server/channels/db/migrations/postgres/000138_add_default_category_name_to_channel.up.sql            |
|                                                    |                                                                                                                                                                  |
|                                                    | MySQL:                                                                                                                                                           |
|                                                    | https://github.com/mattermost/mattermost/blob/release-10.10/server/channels/db/migrations/mysql/000138_add_default_category_name_to_channel.down.sql and         |
|                                                    | https://github.com/mattermost/mattermost/blob/release-10.10/server/channels/db/migrations/mysql/000138_add_default_category_name_to_channel.up.sql               |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Added new columns ``RemoteId`` and ``ChannelId`` to the ``PostAcknowledgements`` table. This is nullable, and stores the remote ID (if available) and channel ID |
|                                                    | to which the post was made when acknowledgements to posts were set. The migrations are fully backwards-compatible and no table locks or                          |
|                                                    | existing operations on the table are impacted by this upgrade. Zero downtime is expected when upgrading to this release. The SQL queries included are:           |
|                                                    |                                                                                                                                                                  |
|                                                    | PostgreSQL:                                                                                                                                                      |
|                                                    | `000141_add_remoteid_channelid_to_post_acknowledgements.down.sql`_ and `000141_add_remoteid_channelid_to_post_acknowledgements.up.sql`_                          |
|                                                    |                                                                                                                                                                  |
|                                                    | MySQL:                                                                                                                                                           |
|                                                    | https://github.com/mattermost/mattermost/blob/release-10.10/server/channels/db/migrations/mysql/000141_add_remoteid_channelid_to_post_acknowledgements.down.sql  |
|                                                    | and                                                                                                                                                              |
|                                                    | https://github.com/mattermost/mattermost/blob/release-10.10/server/channels/db/migrations/mysql/000141_add_remoteid_channelid_to_post_acknowledgements.up.sql    |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Added a new column ``LastMembersSyncAt`` to the ``SharedChannelRemotes`` table and added ``LastMembershipSyncAt`` to ``SharedChannelUsers``. This is nullable,   |
|                                                    | and stores the ``LastMembersSyncAt`` timestamp (if available) which tracks the last time channel membership data was synchronized between the local cluster and  |
|                                                    | each remote cluster. ``LastMembershipSyncAt`` timestamp tracks the last time a specific user's channel membership status was synchronized with a specific remote |
|                                                    | cluster. The migrations are fully backwards-compatible and no table locks or existing operations on the table are impacted by this upgrade. Zero downtime is     |
|                                                    | expected when upgrading to this release. The SQL queries included are:                                                                                           |
|                                                    |                                                                                                                                                                  |
|                                                    | PostgreSQL:                                                                                                                                                      |
|                                                    | https://github.com/mattermost/mattermost/blob/release-10.10/server/channels/db/migrations/postgres/000140_add_lastmemberssyncat_to_sharedchannelremotes.down.sql |
|                                                    | and                                                                                                                                                              |
|                                                    | https://github.com/mattermost/mattermost/blob/release-10.10/server/channels/db/migrations/postgres/000140_add_lastmemberssyncat_to_sharedchannelremotes.up.sql   |
|                                                    |                                                                                                                                                                  |
|                                                    | MySQL:                                                                                                                                                           |
|                                                    | https://github.com/mattermost/mattermost/blob/release-10.10/server/channels/db/migrations/mysql/000140_add_lastmemberssyncat_to_sharedchannelremotes.down.sql    |
|                                                    | and https://github.com/mattermost/mattermost/blob/release-10.10/server/channels/db/migrations/mysql/000140_add_lastmemberssyncat_to_sharedchannelremotes.up.sql  |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Added a new column ``LastGlobalUserSyncAt`` to the ``RemoteClusters`` table. This is nullable, and ``LastGlobalUserSyncAt`` tracks the timestamp of the last     |
|                                                    | successful global user sync for each remote cluster, enabling incremental syncing. The migrations are fully backwards-compatible and no table locks or existing  |
|                                                    | operations on the table are impacted by this upgrade. Zero downtime is expected when upgrading to this release. The SQL queries included are:                    |
|                                                    |                                                                                                                                                                  |
|                                                    | PostgreSQL:                                                                                                                                                      |
|                                                    | https://github.com/mattermost/mattermost/blob/release-10.10/server/channels/db/migrations/postgres/000139_remoteclusters_add_last_global_user_sync_at.down.sql   |
|                                                    | and                                                                                                                                                              |
|                                                    | https://github.com/mattermost/mattermost/blob/release-10.10/server/channels/db/migrations/postgres/000139_remoteclusters_add_last_global_user_sync_at.up.sql     |
|                                                    |                                                                                                                                                                  |
|                                                    | MySQL:                                                                                                                                                           |
|                                                    | https://github.com/mattermost/mattermost/blob/release-10.10/server/channels/db/migrations/mysql/000139_remoteclusters_add_last_global_user_sync_at.down.sql and  |
|                                                    | https://github.com/mattermost/mattermost/blob/release-10.10/server/channels/db/migrations/mysql/000139_remoteclusters_add_last_global_user_sync_at.up.sql        |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v10.9                                              | A new index to the ``CategoryId`` column in ``SidebarChannels`` table was added to improve query performance. No database downtime is expected for this upgrade. |
|                                                    | For PostgreSQL, it takes around 2s to add the index on a table with 1.2M rows with an instance size of 8 cores and 16GB RAM. For MySQL, it takes around 5s on a  |
|                                                    | table with 300K rows on an instance size of 8 cores and 16GB RAM. The migrations are fully backwards-compatible and no table locks or existing operations on the |
|                                                    | table are impacted by this upgrade. Zero downtime is expected when upgrading to this release. The SQL queries included are:                                      |
|                                                    |                                                                                                                                                                  |
|                                                    | **PostgreSQL**:                                                                                                                                                  |
|                                                    |                                                                                                                                                                  |
|                                                    | .. code-block:: sql                                                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    |  CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_sidebarchannels_categoryid ON sidebarchannels(categoryid);                                                          |
|                                                    |                                                                                                                                                                  |
|                                                    | **MySQL**:                                                                                                                                                       |
|                                                    |                                                                                                                                                                  |
|                                                    | .. code-block:: sql                                                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    |  CREATE INDEX idx_sidebarchannels_categoryid ON SidebarChannels(CategoryId);                                                                                     |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Schema changes in the form of a new materialized view (``AttributeView``) was added that aggregates user attributes into a separate table. No database downtime  |
|                                                    | is expected for this upgrade. A previous version of Mattermost can run with the new schema changes. The SQL queries included in the schema changes are below:    |
|                                                    |                                                                                                                                                                  |
|                                                    | PostgreSQL: https://github.com/mattermost/mattermost/blob/release-10.9/server/channels/db/migrations/postgres/000137_update_attribute_view.up.sql                |
|                                                    |                                                                                                                                                                  |
|                                                    | MySQL: https://github.com/mattermost/mattermost/blob/release-10.9/server/channels/db/migrations/mysql/000136_create_attribute_view.up.sql                        |
|                                                    |                                                                                                                                                                  |
|                                                    | The objective of showing the SQL queries is not to reduce downtime, but to let the Admin make the schema changes without requiring to upgrade Mattermost.        |
|                                                    | Then when they actually upgrade Mattermost, it becomes instantaneous since the changes are already made.                                                         |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | When ``SamlSettings.EnableSyncWithLdap`` is enabled, Mattermost will now check if a user exists on the connected LDAP server during login. If the user doesn't   |
|                                                    | exist on the LDAP server, login will fail. Previously, users not present on the LDAP server could login, but would be deactivated on the next LDAP sync.         |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v10.8                                              | New tables ``AccessControlPolicies`` and ``AccessControlPolicyHistory`` will be created. The migration is fully backwards-compatible, non-locking, and zero      |
|                                                    | downtime is expected.                                                                                                                                            |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Support for legacy SKUs E10 and E20 licenses was removed. If you need assistance, `talk to a Mattermost expert <https://mattermost.com/contact-sales/>`__.       |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v10.7                                              | Added new column ``BannerInfo`` in the ``Channels`` table for storing metadata for an upcoming licensed feature. The migration is fully backwards-compatible,    |
|                                                    | non-locking, and zero downtime is possible. Below are the SQL queries included in the schema changes:                                                            |
|                                                    |                                                                                                                                                                  |
|                                                    | **PostgreSQL**:                                                                                                                                                  |
|                                                    |                                                                                                                                                                  |
|                                                    | .. code-block:: sql                                                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    |  ALTER TABLE channels ADD COLUMN IF NOT EXISTS bannerinfo jsonb;                                                                                                 |
|                                                    |                                                                                                                                                                  |
|                                                    | **MySQL**:                                                                                                                                                       |
|                                                    |                                                                                                                                                                  |
|                                                    | .. code-block:: sql                                                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    |  SET @preparedStatement = (SELECT IF(                                                                                                                            |
|                                                    |                                                                                                                                                                  |
|                                                    |     NOT EXISTS(                                                                                                                                                  |
|                                                    |                                                                                                                                                                  |
|                                                    |         SELECT 1 FROM INFORMATION_SCHEMA.COLUMNS                                                                                                                 |
|                                                    |                                                                                                                                                                  |
|                                                    |         WHERE table_name = 'Channels'                                                                                                                            |
|                                                    |                                                                                                                                                                  |
|                                                    |         AND table_schema = DATABASE()                                                                                                                            |
|                                                    |                                                                                                                                                                  |
|                                                    |         AND column_name = 'BannerInfo'                                                                                                                           |
|                                                    |                                                                                                                                                                  |
|                                                    |     ),                                                                                                                                                           |
|                                                    |                                                                                                                                                                  |
|                                                    |     'ALTER TABLE Channels ADD COLUMN BannerInfo json;',                                                                                                          |
|                                                    |                                                                                                                                                                  |
|                                                    |     'SELECT 1;'                                                                                                                                                  |
|                                                    |                                                                                                                                                                  |
|                                                    |  ));                                                                                                                                                             |
|                                                    |                                                                                                                                                                  |
|                                                    |  PREPARE addColumnIfNotExists FROM @preparedStatement;                                                                                                           |
|                                                    |  EXECUTE addColumnIfNotExists;                                                                                                                                   |
|                                                    |  DEALLOCATE PREPARE addColumnIfNotExists;                                                                                                                        |
|                                                    |                                                                                                                                                                  |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Added support for cursor-based pagination on the property architecture tables, including SQL migration to create indices. The migration is fully                 |
|                                                    | backwards-compatible, non-locking, and zero downtime is possible. Below are the SQL queries included in the schema changes:                                      |
|                                                    |                                                                                                                                                                  |
|                                                    | MySQL:                                                                                                                                                           |
|                                                    |                                                                                                                                                                  |
|                                                    | .. code-block:: sql                                                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    |  SET @preparedStatement = (SELECT IF(                                                                                                                            |
|                                                    |      (                                                                                                                                                           |
|                                                    |          SELECT COUNT(*) FROM INFORMATION_SCHEMA.STATISTICS                                                                                                      |
|                                                    |          WHERE table_name = 'PropertyValues'                                                                                                                     |
|                                                    |          AND table_schema = DATABASE()                                                                                                                           |
|                                                    |          AND index_name = 'idx_propertyvalues_create_at_id'                                                                                                      |
|                                                    |      ) > 0,                                                                                                                                                      |
|                                                    |      'SELECT 1',                                                                                                                                                 |
|                                                    |      'CREATE INDEX idx_propertyvalues_create_at_id ON PropertyValues(CreateAt, ID);'                                                                             |
|                                                    |  ));                                                                                                                                                             |
|                                                    |                                                                                                                                                                  |  
|                                                    |  PREPARE createIndexIfNotExists FROM @preparedStatement;                                                                                                         |
|                                                    |  EXECUTE createIndexIfNotExists;                                                                                                                                 |
|                                                    |  DEALLOCATE PREPARE createIndexIfNotExists;                                                                                                                      |
|                                                    |                                                                                                                                                                  |
|                                                    | .. code-block:: sql                                                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    |  SET @preparedStatement = (SELECT IF(                                                                                                                            |
|                                                    |      (                                                                                                                                                           | 
|                                                    |          SELECT COUNT(*) FROM INFORMATION_SCHEMA.STATISTICS                                                                                                      |
|                                                    |          WHERE table_name = 'PropertyFields'                                                                                                                     |
|                                                    |          AND table_schema = DATABASE()                                                                                                                           |
|                                                    |          AND index_name = 'idx_propertyfields_create_at_id'                                                                                                      |
|                                                    |      ) > 0,                                                                                                                                                      |
|                                                    |      'SELECT 1',                                                                                                                                                 |
|                                                    |      'CREATE INDEX idx_propertyfields_create_at_id ON PropertyFields(CreateAt, ID);'                                                                             |
|                                                    |  ));                                                                                                                                                             |
|                                                    |                                                                                                                                                                  |
|                                                    |  PREPARE createIndexIfNotExists FROM @preparedStatement;                                                                                                         |
|                                                    |  EXECUTE createIndexIfNotExists;                                                                                                                                 |
|                                                    |  DEALLOCATE PREPARE createIndexIfNotExists;                                                                                                                      |
|                                                    |                                                                                                                                                                  |
|                                                    | PostgreSQL:                                                                                                                                                      |
|                                                    |                                                                                                                                                                  |
|                                                    | .. code-block:: sql                                                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    |  CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_propertyvalues_create_at_id ON PropertyValues(CreateAt, ID)                                                         |
|                                                    |                                                                                                                                                                  |
|                                                    | .. code-block:: sql                                                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    |  CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_propertyfields_create_at_id ON PropertyFields(CreateAt, ID)                                                         | 
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v10.6                                              | Support for PostgreSQL v11 and v12 have been removed. The new minimum PostgreSQL version is v13+.                                                                |
|                                                    | See the                                                                                                                                                          |
|                                                    | :ref:`minimum supported PostgreSQL version policy <deployment-guide/software-hardware-requirements:minimum postgresql database support policy>` documentation    |
|                                                    | for details.                                                                                                                                                     |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | System Console statistics now perform faster on PostgreSQL. The ``MaxUsersForStatistics`` configuration setting now only disables the **User counts with posts** |
|                                                    | chart, while all other stats remain unaffected. The other stats remain unaffected because that configuration value is no longer needed to disable the other      |
|                                                    | queries since they are always fast now. Post and file counts update daily, so they may not always reflect real-time data. Advanced stats, such as line charts    |
|                                                    | and plugin data, are now hidden until clicked, reducing load time. No performance improvements apply to MySQL since it's scheduled for full deprecation in v11.  |
|                                                    | We recommend migrating to PostgreSQL for better performance and long-term support. Migration times: On a system with 12M posts, and 1M fileinfo entries, the     |
|                                                    | migration takes 15s, but could take several minutes depending on the server's table sizes and database specs. This migration is non-locking. Note that there is  |                                                                                                       
|                                                    | no migration for MySQL deployments because this optimization is only applicable for PostgreSQL. Below are the SQL queries included in the schema changes:        |
|                                                    |                                                                                                                                                                  |
|                                                    | .. code-block:: sql                                                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    |  CREATE MATERIALIZED VIEW IF NOT EXISTS posts_by_team_day as                                                                                                     |
|                                                    |  SELECT to_timestamp(p.createat/1000)::date as day, COUNT(*) as num, teamid                                                                                      |
|                                                    |  FROM posts p JOIN channels c on p.channelid=c.id                                                                                                                |
|                                                    |  GROUP BY day, c.teamid;                                                                                                                                         |
|                                                    |                                                                                                                                                                  |                                                                              
|                                                    |  CREATE MATERIALIZED VIEW IF NOT EXISTS bot_posts_by_team_day as                                                                                                 |
|                                                    |  SELECT to_timestamp(p.createat/1000)::date as day, COUNT(*) as num, teamid                                                                                      |
|                                                    |  FROM posts p                                                                                                                                                    |                                                                                                
|                                                    |  JOIN Bots b ON p.UserId = b.Userid                                                                                                                              | 
|                                                    |  JOIN channels c on p.channelid=c.id                                                                                                                             | 
|                                                    |  GROUP BY day, c.teamid;                                                                                                                                         | 
|                                                    |                                                                                                                                                                  | 
|                                                    |  CREATE MATERIALIZED VIEW IF NOT EXISTS file_stats as                                                                                                            | 
|                                                    |  SELECT COUNT(*) as num, COALESCE(SUM(Size), 0) as usage                                                                                                         | 
|                                                    |  FROM fileinfo                                                                                                                                                   | 
|                                                    |  WHERE DeleteAt = 0;                                                                                                                                             | 
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v10.5                                              | Mattermost versions v10.5.0 and v10.5.1 include a bundled Jira plugin (v4.2.0) that contains a bug which may cause plugin configuration settings to disappear.   |
|                                                    | We strongly advise against upgrading to these versions to avoid potential disruption.                                                                            |
|                                                    | If you have already upgraded to v10.5.0 or v10.5.1, we recommend updating the Jira plugin to version v4.2.1,                                                     |
|                                                    | or preferably, upgrading both Mattermost and the Jira plugin to their latest available versions.                                                                 |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | The internal workings of the `PluginLinkComponent` in the web app have been changed to unmount link tooltips from the DOM by default, significantly improving    |
|                                                    | performance. Plugins that register link tooltips using `registerLinkTooltipComponent` will experience changes in how tooltip components are managed—they are     |
|                                                    | now only mounted when a link is hovered over or focused. As a result, plugins may need to update their components to properly handle mounting and unmounting     |
|                                                    | scenarios. For example, changes were made in `mattermost-plugin-jira <https://github.com/mattermost/mattermost-plugin-jira/pull/1145>`_, where                   |
|                                                    | componentDidUpdate lifecycle hook was replaced with componentDidMount. If your plugin’s tooltip component is a functional React component, there is a high       |
|                                                    | chance that this behavior will be handled automatically, as it would be managed by useEffect with an empty dependency array.                                     |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | The Mattermost server has stopped supporting manual plugin deployment. Plugins were deployed manually when an administrator or some deployment automation copies |
|                                                    | the contents of a plugin bundle into the server's working directory. If a manual or automated deployment workflow is still required, administrators can instead  |
|                                                    | prepackage the plugin bundles. See `this forum post <https://forum.mattermost.com/t/deprecation-notice-manual-plugin-deployment/21192>`__ for details.           |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Mattermost has stopped official Mattermost server builds for the Microsoft Windows operating system. Administrators should migrate existing Mattermost server    |
|                                                    | installations to use the official Linux builds. See more details in                                                                                              |
|                                                    | `this forum post <https://forum.mattermost.com/t/deprecation-notice-server-builds-for-microsoft-windows/21498>`__.                                               |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | v10.5 introduces updates to the Compliance Export functionality, which will modify how exported data is structured, stored and processed. These changes          |
|                                                    | primarily affect System Administrators and the main changes are outlined below. See more details in                                                              |
|                                                    | the `Compliance Export documentation <https://docs.mattermost.com/administration-guide/comply/compliance-export.html>`_.                                         |
|                                                    |                                                                                                                                                                  |
|                                                    | Output files and directories have changed - Previously we were exporting a single zip containing all the batch directories. Now we will export a single          |
|                                                    | directory, and under that directory each batch will be its own zip.                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    | Compliance exports performance improvements - Compliance exports should now be at least 50% faster, and possibly more.                                           |
|                                                    |                                                                                                                                                                  |
|                                                    | Logic improvements - We’ve made improvements and fixed bugs that we found.                                                                                       |
|                                                    |                                                                                                                                                                  |
|                                                    | Changes specific to each Export Type - The export output formats have been changed. Some fields’ semantic meaning has been clarified, and there are a number of  |
|                                                    | new fields. Our goal was to maintain backwards compatibility while fixing the logic bugs.                                                                        |
|                                                    |                                                                                                                                                                  |
|                                                    | See the :doc:`compliance export </administration-guide/comply/compliance-export>` product documentation for details.                                             |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | As part of the Property System Architecture feature, Mattermost v10.5 is going to run a set of migrations to add new tables to the schema. This migration only   |
|                                                    | creates new tables and indexes, so there is no impact on preexisting data.                                                                                       |
|                                                    |                                                                                                                                                                  |
|                                                    | New tables ``PropertyGroups``, ``PropertyFields`` and ``PropertyValues`` are going to be created.                                                                |
|                                                    |                                                                                                                                                                  |
|                                                    | In the case of PostgreSQL, a new enum type ``property_field_type`` is going to be created, to be used in the ``Type`` column of the ``PropertyFields`` table.    |
|                                                    |                                                                                                                                                                  |
|                                                    | The ``PropertyFields`` and ``PropertyValues`` tables have a unique constraint that will generate an index in MySQL, and in the case of PostgreSQL, they directly |
|                                                    | use a ``UNIQUE INDEX`` to enforce this constraint.                                                                                                               |
|                                                    |                                                                                                                                                                  |
|                                                    | A new index ``idx_propertyvalues_targetid_groupid`` will be created for the ``PropertyValues`` table.                                                            |
|                                                    |                                                                                                                                                                  |
|                                                    | The migration is only creating new tables with no data. The migration is backwards-compatible, and a previous version of Mattermost can run with the new schema  |
|                                                    | changes. No table locks or existing operations on the table are impacted by this upgrade. Zero downtime is possible when upgrading to this release.              |
|                                                    |                                                                                                                                                                  |
|                                                    | Below are the SQL queries included in the schema changes:                                                                                                        |
|                                                    |                                                                                                                                                                  |
|                                                    | **MySQL**:                                                                                                                                                       |
|                                                    |                                                                                                                                                                  |
|                                                    | .. code-block:: sql                                                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    |  CREATE TABLE IF NOT EXISTS PropertyGroups (                                                                                                                     |
|                                                    |   ID varchar(26) PRIMARY KEY,                                                                                                                                    |
|                                                    |   Name varchar(64) NOT NULL,                                                                                                                                     |
|                                                    |   UNIQUE(Name)                                                                                                                                                   |
|                                                    |  );                                                                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    |  CREATE TABLE IF NOT EXISTS PropertyFields (                                                                                                                     |
|                                                    |   ID varchar(26) PRIMARY KEY,                                                                                                                                    |
|                                                    |   GroupID varchar(26) NOT NULL,                                                                                                                                  |
|                                                    |   Name varchar(255) NOT NULL,                                                                                                                                    |
|                                                    |   Type enum('text', 'select', 'multiselect', 'date', 'user', 'multiuser'),                                                                                       |
|                                                    |   Attrs json,                                                                                                                                                    |
|                                                    |   TargetID varchar(255),                                                                                                                                         |
|                                                    |   TargetType varchar(255),                                                                                                                                       |
|                                                    |   CreateAt bigint(20),                                                                                                                                           |
|                                                    |   UpdateAt bigint(20),                                                                                                                                           |
|                                                    |   DeleteAt bigint(20),                                                                                                                                           |
|                                                    |   UNIQUE(GroupID, TargetID, Name, DeleteAt)                                                                                                                      |
|                                                    |  );                                                                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    |  CREATE TABLE IF NOT EXISTS PropertyValues (                                                                                                                     |
|                                                    |   ID varchar(26) PRIMARY KEY,                                                                                                                                    |
|                                                    |   TargetID varchar(255) NOT NULL,                                                                                                                                |
|                                                    |   TargetType varchar(255) NOT NULL,                                                                                                                              |
|                                                    |   GroupID varchar(26) NOT NULL,                                                                                                                                  |
|                                                    |   FieldID varchar(26) NOT NULL,                                                                                                                                  |
|                                                    |   Value json,                                                                                                                                                    |
|                                                    |   CreateAt bigint(20),                                                                                                                                           |
|                                                    |   UpdateAt bigint(20),                                                                                                                                           |
|                                                    |   DeleteAt bigint(20),                                                                                                                                           |
|                                                    |   UNIQUE(GroupID, TargetID, FieldID, DeleteAt)                                                                                                                   |
|                                                    |  );                                                                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    |  SET @preparedStatement = (SELECT IF(                                                                                                                            |
|                                                    |   (                                                                                                                                                              |
|                                                    |      SELECT COUNT(*) FROM INFORMATION_SCHEMA.STATISTICS                                                                                                          |
|                                                    |      WHERE table_name = 'PropertyValues'                                                                                                                         |
|                                                    |      AND table_schema = DATABASE()                                                                                                                               |
|                                                    |      AND index_name = 'idx_propertyvalues_targetid_groupid'                                                                                                      |
|                                                    |   ) > 0,                                                                                                                                                         |
|                                                    |   'SELECT 1',                                                                                                                                                    |
|                                                    |   'CREATE INDEX idx_propertyvalues_targetid_groupid ON PropertyValues (TargetID, GroupID);'                                                                      |
|                                                    |  ));                                                                                                                                                             |
|                                                    |                                                                                                                                                                  |
|                                                    |  PREPARE createIndexIfNotExists FROM @preparedStatement;                                                                                                         |
|                                                    |  EXECUTE createIndexIfNotExists;                                                                                                                                 |
|                                                    |  DEALLOCATE PREPARE createIndexIfNotExists;                                                                                                                      |
|                                                    |                                                                                                                                                                  |
|                                                    |                                                                                                                                                                  |
|                                                    | **PostgreSQL**:                                                                                                                                                  |
|                                                    |                                                                                                                                                                  |
|                                                    | .. code-block:: sql                                                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    |  CREATE TABLE IF NOT EXISTS PropertyGroups (                                                                                                                     |
|                                                    |   ID varchar(26) PRIMARY KEY,                                                                                                                                    |
|                                                    |   Name varchar(64) NOT NULL,                                                                                                                                     |
|                                                    |   UNIQUE(Name)                                                                                                                                                   |
|                                                    |  );                                                                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    |  DO                                                                                                                                                              |
|                                                    |  BEGIN                                                                                                                                                           |
|                                                    |    IF NOT EXISTS (SELECT * FROM pg_type typ                                                                                                                      |
|                                                    |                          INNER JOIN pg_namespace nsp ON nsp.oid = typ.typnamespace                                                                               |
|                                                    |                      WHERE nsp.nspname = current_schema()                                                                                                        |
|                                                    |                          AND typ.typname = 'property_field_type') THEN                                                                                           |
|                                                    |   CREATE TYPE property_field_type AS ENUM (                                                                                                                      |
|                                                    |      'text',                                                                                                                                                     |
|                                                    |      'select',                                                                                                                                                   |
|                                                    |      'multiselect',                                                                                                                                              |
|                                                    |      'date',                                                                                                                                                     |
|                                                    |      'user',                                                                                                                                                     |
|                                                    |      'multiuser'                                                                                                                                                 |
|                                                    |   );                                                                                                                                                             |
|                                                    |    END IF;                                                                                                                                                       |
|                                                    |  END;                                                                                                                                                            |
|                                                    |  LANGUAGE plpgsql;                                                                                                                                               |
|                                                    |                                                                                                                                                                  |
|                                                    |  CREATE TABLE IF NOT EXISTS PropertyFields (                                                                                                                     |
|                                                    |   ID varchar(26) PRIMARY KEY,                                                                                                                                    |
|                                                    |   GroupID varchar(26) NOT NULL,                                                                                                                                  |
|                                                    |   Name varchar(255) NOT NULL,                                                                                                                                    |
|                                                    |   Type property_field_type,                                                                                                                                      |
|                                                    |   Attrs jsonb,                                                                                                                                                   |
|                                                    |   TargetID varchar(255),                                                                                                                                         |
|                                                    |   TargetType varchar(255),                                                                                                                                       |
|                                                    |   CreateAt bigint NOT NULL,                                                                                                                                      |
|                                                    |   UpdateAt bigint NOT NULL,                                                                                                                                      |
|                                                    |   DeleteAt bigint NOT NULL                                                                                                                                       |
|                                                    |  );                                                                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    |  CREATE UNIQUE INDEX IF NOT EXISTS idx_propertyfields_unique ON PropertyFields (GroupID, TargetID, Name) WHERE DeleteAt = 0;                                     |
|                                                    |                                                                                                                                                                  |
|                                                    |  CREATE TABLE IF NOT EXISTS PropertyValues (                                                                                                                     |
|                                                    |   ID varchar(26) PRIMARY KEY,                                                                                                                                    |
|                                                    |   TargetID varchar(255) NOT NULL,                                                                                                                                |
|                                                    |   TargetType varchar(255) NOT NULL,                                                                                                                              |
|                                                    |   GroupID varchar(26) NOT NULL,                                                                                                                                  |
|                                                    |   FieldID varchar(26) NOT NULL,                                                                                                                                  |
|                                                    |   Value jsonb NOT NULL,                                                                                                                                          |
|                                                    |   CreateAt bigint NOT NULL,                                                                                                                                      |
|                                                    |   UpdateAt bigint NOT NULL,                                                                                                                                      |
|                                                    |   DeleteAt bigint NOT NULL                                                                                                                                       |
|                                                    |  );                                                                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    |  CREATE UNIQUE INDEX IF NOT EXISTS idx_propertyvalues_unique ON PropertyValues (GroupID, TargetID, FieldID) WHERE DeleteAt = 0;                                  |
|                                                    |  CREATE INDEX IF NOT EXISTS idx_propertyvalues_targetid_groupid ON PropertyValues (TargetID, GroupID);                                                           |
|                                                    |      ``                                                                                                                                                          |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v10.4                                              | There are no important upgrade notes in v10.4 release.                                                                                                           |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v10.3                                              | The Classic Mobile App has been phased out. Please download the new v2 Mobile App from the                                                                       |
|                                                    | `Apple App Store <https://apps.apple.com/us/app/mattermost/id1257222717>`__ or                                                                                   |
|                                                    | `Google Play Store <https://play.google.com/store/apps/details?id=com.mattermost.rn>`__. See more details                                                        |
|                                                    | in the `classic mobile app deprecation <https://forum.mattermost.com/t/classic-mobile-app-deprecation/18703>`_ Mattermost forum post.                            |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v10.2                                              | Docker Content Trust (DCT) for signing Docker image artifacts has been replaced by Sigstore Cosign in v10.2 (November, 2024). If you rely                        |
|                                                    | on artifact verification using DCT, please `transition to using Cosign <https://edu.chainguard.dev/open-source/sigstore/cosign/how-to-install-cosign/>`_. See    |
|                                                    | the `upcoming DCT deprecation <https://forum.mattermost.com/t/upcoming-dct-deprecation/19275>`_ Mattermost forum post for more details.                          |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v10.1                                              | There are no important upgrade notes in v10.1 release.                                                                                                           |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v10.0                                              | We no longer support new installations using MySQL starting in v10. All new customers and/or deployments will only be supported with the minimum supported       |
|                                                    | version of the PostgreSQL database. End of support for MySQL is targeted for Mattermost v11.                                                                     |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Apps Framework is deprecated for new installs. Please extend Mattermost using webhooks, slash commands, OAuth2 apps, and plugins.                                |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Mattermost v10 introduces Playbooks v2 for all Enterprise licensed customers. Professional SKU customers may continue to use Playbooks v1 uninterrupted which    |
|                                                    | will be maintained and supported until September 2025, followed by an appropriate grandfathering strategy. More detailed information and the discussion are      |
|                                                    | available on our `forums here <https://forum.mattermost.com/t/clarification-on-playbooks-in-mattermost-v10/20563>`_.                                             |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Renamed ``Channel Moderation`` to ``Advanced Access Control`` in the channel management section in the **System Console**.                                       |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Renamed announcement banner feature to “system-wide notifications”.                                                                                              |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Renamed “Collapsed Reply Threads” to “Threaded Discussions” in the System Console.                                                                               |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Renamed “System Roles” to “Delegated Granular Administration” in the System Console.                                                                             |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Renamed "Office 365" to "Entra ID" for SSO logins.                                                                                                               |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Fully deprecated the ``/api/v4/image`` endpoint when the image proxy is disabled.                                                                                |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Pre-packaged `Calls plugin v1.0.1 <https://github.com/mattermost/mattermost-plugin-calls/releases/tag/v1.0.1>`_. This includes breaking changes including        | 
|                                                    | the removal of group calls from unlicensed servers in order to focus supportability and quality on licensed servers. Unlicensed servers can continue to use      |
|                                                    | Calls in direct message channels, which represent the majority of activity.                                                                                      |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Removed deprecated ``Config.ProductSettings``, ``LdapSettings.Trace``, and ``AdvancedLoggingConfig`` configuration fields.                                       |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Removed deprecated ``pageSize`` query parameter from most API endpoints.                                                                                         |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Deprecated the experimental Strict CSRF token enforcement. This feature will be fully removed in Mattermost v11.                                                 |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v9.11                                              | Added support for Elasticsearch v8. Also added Beta support for OpenSearch v1.x and v2.x. A new config setting ``ElasticsearchSettings.Backend`` has been        |
|                                                    | added to differentiate between Elasticsearch and OpenSearch. The default value is ``elasticsearch`` which breaks support for AWS Elasticsearch v7.10.x           |
|                                                    | since the official v8 client only works from Elasticsearch v7.11+ versions.                                                                                      |
|                                                    |                                                                                                                                                                  |
|                                                    | .. note::                                                                                                                                                        |
|                                                    |                                                                                                                                                                  |
|                                                    |   - For AWS customers on OpenSearch, you must modify Mattermost configuration from ``elasticsearch`` to ``opensearch`` and disable compatibility mode.           |
|                                                    |     See the `OpenSearch documentation <https://docs.aws.amazon.com/opensearch-service/latest/developerguide/version-migration.html>`_ for details on upgrading.  |
|                                                    |   - After upgrading the Mattermost server, use :ref:`mmctl <administration-guide/manage/mmctl-command-line-tool:mmctl config set>` or edit the config manually,  |
|                                                    |     then restart the Mattermost server.                                                                                                                          |
|                                                    |   - If you are using OpenSearch, you **must** set the backend to ``opensearch``. Otherwise Mattermost will not work.                                             |
|                                                    |                                                                                                                                                                  |
|                                                    | If you are using Elasticsearch v8, be sure to set ``action.destructive_requires_name`` to ``false`` in ``elasticsearch.yml`` to allow for wildcard operations to |
|                                                    | work.                                                                                                                                                            |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v9.10                                              | There are no important upgrade notes in v9.10 release.                                                                                                           |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v9.9                                               | There are no important upgrade notes in v9.9 release.                                                                                                            |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v9.8                                               | There are no important upgrade notes in v9.8 release.                                                                                                            |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v9.7                                               | There are no important upgrade notes in v9.7 release.                                                                                                            |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v9.6                                               | There are no important upgrade notes in v9.6 release.                                                                                                            |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v9.5                                               | We have stopped supporting MySQL v5.7 since it's at the end of life. We urge customers to upgrade their MySQL instance at their earliest convenience.            |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Added safety limit error message in compiled Team Edition and Enterprise Edition deployments when enterprise scale and access control automation features are    |
|                                                    | unavailable and count of users who are registered and not deactivated exceeds 10,000.                                                                            |
|                                                    | :doc:`ERROR_SAFETY_LIMITS_EXCEEDED </administration-guide/manage/admin/error-codes>`.                                                                            |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v9.4                                               | There are no important upgrade notes in v9.4 release.                                                                                                            |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v9.3                                               | There are no important upgrade notes in v9.3 release.                                                                                                            |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v9.2                                               | Fixed data retention policies to run jobs when any custom retention policy is enabled even when the global retention policy is set to "keep-forever". Before     |
|                                                    | this fix, the enabled custom data retention policies wouldn't run as long as the global data retention policy was set to "keep-forever" or was disabled. After   |
|                                                    | the fix, the custom data retention policies will run automatically even when the global data retention policy is set to "keep-forever". Once the server is       |
|                                                    | upgraded, posts may unintentionally be deleted. Admins should make sure to disable all custom data retention policies before upgrading, and then re-enable       |
|                                                    | them again after upgrading.                                                                                                                                      |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v9.1                                               | Minimum supported Desktop App version is now v5.3. OAuth/SAML flows were modified to include ``desktop_login`` which makes earlier versions incompatible.        |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v9.0                                               | Removed the deprecated Insights feature.                                                                                                                         |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Mattermost Boards and various other plugins have transitioned to being fully community supported. See this                                                       |
|                                                    | `forum post <https://forum.mattermost.com/t/upcoming-product-changes-to-boards-and-various-plugins/16669>`_ for more details.                                    |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | The ``channel_viewed`` websocket event was changed to ``multiple_channels_viewed``, and is now only triggered for channels that actually have unread messages.   |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v8.1                                               | In v8.1.2, improved performance on data retention ``DeleteOrphanedRows`` queries.                                                                                |
|                                                    |                                                                                                                                                                  |
|                                                    | New migration for a new table:                                                                                                                                   |
|                                                    |                                                                                                                                                                  |
|                                                    | **MySQL**:                                                                                                                                                       |
|                                                    |                                                                                                                                                                  |
|                                                    | .. code-block:: sql                                                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    |  CREATE TABLE                                                                                                                                                    |
|                                                    |                                                                                                                                                                  |
|                                                    |  IF NOT EXISTS                                                                                                                                                   |
|                                                    |    RetentionIdsForDeletion(Id                                                                                                                                    |
|                                                    |      VARCHAR(26) NOT NULL,                                                                                                                                       |
|                                                    |      TableName VARCHAR(64),                                                                                                                                      |
|                                                    |      Ids json, PRIMARY KEY (Id                                                                                                                                   |
|                                                    |        ), KEY                                                                                                                                                    |
|                                                    |      idx_retentionidsfordeletion_tablename                                                                                                                       |
|                                                    |      (TableName)) ENGINE =                                                                                                                                       |
|                                                    |    InnoDB DEFAULT CHARSET =                                                                                                                                      |
|                                                    |    utf8mb4;                                                                                                                                                      |
|                                                    |    ``                                                                                                                                                            |
|                                                    |                                                                                                                                                                  |
|                                                    | **PostgreSQL**:                                                                                                                                                  |
|                                                    |                                                                                                                                                                  |
|                                                    | .. code-block:: sql                                                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    |  CREATE TABLE                                                                                                                                                    |
|                                                    |                                                                                                                                                                  |
|                                                    |  IF NOT EXISTS                                                                                                                                                   |
|                                                    |    retentionidsfordeletion(id                                                                                                                                    |
|                                                    |      VARCHAR(26) PRIMARY KEY,                                                                                                                                    |
|                                                    |      tablename VARCHAR(64),                                                                                                                                      |
|                                                    |      ids VARCHAR(26) []);                                                                                                                                        |
|                                                    |    CREATE INDEX                                                                                                                                                  |
|                                                    |                                                                                                                                                                  |
|                                                    |  IF NOT EXISTS                                                                                                                                                   |
|                                                    |    idx_retentionidsfordeletion_tablename                                                                                                                         |
|                                                    |    ON retentionidsfordeletion(                                                                                                                                   |
|                                                    |      tablename);                                                                                                                                                 |
|                                                    |    ``                                                                                                                                                            |
|                                                    |                                                                                                                                                                  |
|                                                    | Hard deleting a user or a channel will now also clean up associated reactions.                                                                                   |
|                                                    |                                                                                                                                                                  |
|                                                    | Removed feature flag ``DataRetentionConcurrencyEnabled``. Data retention now runs without concurrency in order to avoid any performance degradation.             |
|                                                    |                                                                                                                                                                  |
|                                                    | Added a new configuration setting ``DataRetentionSettings.RetentionIdsBatchSize``, which allows admins to configure how many batches of IDs will be fetched at   |
|                                                    | a time when deleting orphaned reactions. The default value is 100.                                                                                               |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v8.0                                               | Insights has been deprecated for all new instances and for existing servers that upgrade to v8.0. See more details in                                            |
|                                                    | `this forum post <https://forum.mattermost.com/t/proposal-to-revise-our-insights-feature-due-to-known-performance-issues/16212>`_  on why Insights has           |
|                                                    | been deprecated.                                                                                                                                                 |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | The Focalboard plugin is now disabled by default for all new instances and can be enabled in the **System Console > Plugin settings**.                           |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | The Channel Export and Apps plugins are now disabled by default.                                                                                                 |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Apps Bar is now enabled by default for on-prem servers. ``ExperimentalSettings.EnableAppBar`` was also renamed to ``ExperimentalSettings.DisableAppBar``.        |
|                                                    | See the :ref: `configuration settings <administration-guide/configure/experimental-configuration-settings:disable-apps-bar>` documentation, and                  |
|                                                    | `this forum article <https://forum.mattermost.com/t/channel-header-plugin-changes/13551>`_ for details.                                                          |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | In the main `server package`, the Go module path has changed from ``github.com/mattermost/mattermost-server/server/v8`` to                                       |
|                                                    | ``github.com/mattermost/mattermost/server/v8``. But with the introduction of the `public` submodule, it should no longer be necessary for third-party code to    |
|                                                    | import this `server` package.                                                                                                                                    |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Introduced the `public <https://github.com/mattermost/mattermost/tree/master/server/public>`_ submodule, housing the familiar `model` and `plugin` packages,     |
|                                                    | but now discretely versioned from the server. It is no longer necessary to `go get` a particular commit hash, as Go programs and plugins can now opt-in to       |
|                                                    | importing `github.com/mattermost/mattermost-server/server/public` and managing versions idiomatically. While this submodule has not yet shipped a v1 and will    |
|                                                    | introduce breaking changes before stabilizing the API, it remains both forwards and backwards compatible with the Mattermost server itself.                      |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | As part of the `public` submodule above, a ``context.Context`` is now passed to ``model.Client4`` methods.                                                       |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Removed support for PostgreSQL v10. The new minimum PostgreSQL version is now v11.                                                                               |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | The Mattermost public API for Go is now available as a distinctly versioned package. Instead of pinning a particular commit hash, use idiomatic Go to add this   |
|                                                    | package as a dependency: go get `github.com/mattermost/mattermost-server/server/public`. This relocated Go API maintains backwards compatibility with Mattermost |
|                                                    | v7. Furthermore, the existing Go API previously at github.com/mattermost/mattermost-server/v6/model remains forward compatible with Mattermost v8, but may not   |
|                                                    | contain newer features. Plugins do not need to be recompiled, but developers may opt in to using the new package to simplify their build process. The new public |
|                                                    | package is shipping alongside Mattermost v8 as version 0.5.0 to allow for some additional code refactoring before releasing as v1 later this year.               |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Three configuration fields have been added, ``LogSettings.AdvancedLoggingJSON``, ``ExperimentalAuditSettings.AdvancedLoggingJSON``, and                          |
|                                                    | ``NotificationLogSettings.AdvancedLoggingJSON`` which support multi-line JSON, escaped JSON as a string, or a filename that points to a file containing JSON.    |
|                                                    | The ``AdvancedLoggingConfig`` fields have been deprecated.                                                                                                       |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | The Go MySQL driver has changed the ``maxAllowedPacket`` size from 4MiB to 64MiB. This is to make it consistent with the change in the server side default value |
|                                                    | from MySQL 5.7 to MySQL 8.0. If your ``max_allowed_packet`` setting is not 64MiB, then please update the MySQL config DSN with an additional param of            |
|                                                    | ``maxAllowedPacket`` to match with the server side value. Alternatively, a value of 0 can be set to to automatically fetch the server side value, on every new   |
|                                                    | connection, which has a performance overhead.                                                                                                                    |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Removed ``ExperimentalSettings.PatchPluginsReactDOM``. If this setting was previously enabled, confirm that:                                                     |
|                                                    |                                                                                                                                                                  |
|                                                    | 1. All Mattermost-supported plugins are updated to the latest versions.                                                                                          |
|                                                    | 2. Any other plugins have been updated to support React 17. See the section for v7.7 release for more information.                                               |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Removed deprecated ``PermissionUseSlashCommands``.                                                                                                               |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Removed deprecated ``model.CommandArgs.Session``.                                                                                                                |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | For servers wanting to allow websockets to connect from origins other than the origin of the site URL, please set the ``ServiceSettings.AllowCorsFrom``          |
|                                                    | :ref:`configuration setting <administration-guide/configure/integrations-configuration-settings:enable cross-origin requests from>`. Also ensure that            |
|                                                    | the ``siteURL`` is set correctly.                                                                                                                                |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | In v8.0 release, the following repositories are merged into one: ``mattermost-server``, ``mattermost-webapp`` and ``mmctl``.                                     |
|                                                    | Developers should read the updated `Developer Guide <https://developers.mattermost.com/contribute/developer-setup/>`_ for details.                               |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Fixed an issue caused by a migration in the previous release. Query takes around 11ms on a PostgreSQL 14 DB t3.medium RDS instance. Locks on the preferences     |
|                                                    | table will only be acquired if there are rows to delete, but the time taken is negligible.                                                                       |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Fixed an issue where a user would still see threads in the threads view of channels they have left. Migration execution time in PostgreSQL: Execution time:      |
|                                                    | 58.11 sec, DELETE 2766690. Migration execution time in MySQL: Query OK, 2766769 rows affected (4 min 47.57 sec).                                                 |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | For servers wanting to allow websockets to connect from other origins, please set the ``ServiceSettings.AllowCorsFrom`` config setting.                          |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | The file info stats query is now optimized by denormalizing the ``channelID`` column into the table itself. This will speed up the query to get the file count   |
|                                                    | for a channel when selecting the right-hand pane. Migration times:                                                                                               |
|                                                    |                                                                                                                                                                  |
|                                                    | On a PostgreSQL 12.14 DB with 1731 rows in FileInfo and 11M posts, it took around 0.27s                                                                          |
|                                                    |                                                                                                                                                                  |
|                                                    | On a MySQL 8.0.31 DB with 1405 rows in FileInfo and 11M posts, it took around 0.3s                                                                               |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v7.10                                              | In v7.10.1, fixed an issue caused by a migration in the previous release. Query takes around 11ms on a PostgreSQL 14 DB t3.medium RDS instance. Locks on the     |
|                                                    | preferences table will only be acquired if there are rows to delete, but the time taken is negligible.                                                           |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | In v7.10.1, fixed an issue where a user would still see threads in the threads view of channels they have left. Migration execution time in MySQL: Query OK,     |
|                                                    | 2766769 rows affected (4 min 47.57 sec). Migration execution time in PostgreSQL: 58.11 sec, DELETE 2766690.                                                      |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | In v7.10.3, for servers wanting to allow websockets to connect from origins other than the origin of the site URL, please set the                                |
|                                                    | ``ServiceSettings.AllowCorsFrom``                                                                                                                                |
|                                                    | :ref:`configuration setting <administration-guide/configure/integrations-configuration-settings:enable cross-origin requests from>`. Also ensure that            |
|                                                    | the ``siteURL`` is set correctly.                                                                                                                                |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v7.9                                               | Added a new index on ``Posts(OriginalId)``. For a database with 11.8 million posts, on a machine with a i7-11800H CPU (8 cores, 16 threads), 32GiB of RAM and    |
|                                                    | SSD, the index creation takes 98.51s on MYSQL and 2.6s on PostgreSQL.                                                                                            |
|                                                    |                                                                                                                                                                  |
|                                                    | - In PostgreSQL databases, the ``Posts`` table will be locked during index creation. To avoid locking this table, admins can create the index manually before    |
|                                                    |   performing the upgrade using the following non-blocking query: ``CREATE INDEX CONCURRENTLY idx_posts_original_id ON Posts(OriginalId);``.                      |
|                                                    | - Admins managing PostgreSQL deployments containing fewer posts may prefer that the migration process creates the index, and accept that ``Posts`` table will    |
|                                                    |   remain locked until the migration is complete.                                                                                                                 |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | In v7.9.4, fixed an issue where a user would still see threads in the threads view of channels they have left. Migration execution time in MySQL: Query OK,      |
|                                                    | 2766769 rows affected (4 min 47.57 sec). Migration execution time in PostgreSQL: 58.11 sec, DELETE 2766690.                                                      |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | In v7.9.4, backported a fix related Oauth 2. Query times depend on if you have rows to delete or not.                                                            |
|                                                    |                                                                                                                                                                  |
|                                                    | With no rows to delete:                                                                                                                                          |
|                                                    |                                                                                                                                                                  |
|                                                    | - MySQL v5.7.12: 9ms                                                                                                                                             |
|                                                    | - PostgreSQL v10: 21ms                                                                                                                                           |
|                                                    |                                                                                                                                                                  |
|                                                    | 4 rows:                                                                                                                                                          |
|                                                    |                                                                                                                                                                  |
|                                                    | - MySQL v5.7.12: 17.2ms                                                                                                                                          |
|                                                    | - PostgreSQL v10: 9.9ms                                                                                                                                          |
|                                                    |                                                                                                                                                                  |
|                                                    | Those times are based off the following table sizes:                                                                                                             |
|                                                    |                                                                                                                                                                  |
|                                                    | - Preferences: 2 million records                                                                                                                                 |
|                                                    | - ``oauthaccessdata`` and sessions: 10 records                                                                                                                   |
|                                                    |                                                                                                                                                                  |
|                                                    | You can assess the number of impacted rows by running the following:                                                                                             |
|                                                    |                                                                                                                                                                  |
|                                                    | **PostgreSQL**:                                                                                                                                                  |
|                                                    |                                                                                                                                                                  |
|                                                    | .. code-block:: sql                                                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    |  SELECT count(o.*)                                                                                                                                               |
|                                                    |  FROM oauthaccessdata o                                                                                                                                          |
|                                                    |   WHERE NOT EXISTS (                                                                                                                                             |
|                                                    |      SELECT p.*                                                                                                                                                  |
|                                                    |      FROM preferences p                                                                                                                                          |
|                                                    |      WHERE o.clientid = p.name                                                                                                                                   |
|                                                    |        AND o.userid = p.                                                                                                                                         |
|                                                    |        userid                                                                                                                                                    |
|                                                    |        AND p.category =                                                                                                                                          |
|                                                    |        'oauth_app'                                                                                                                                               |
|                                                    |      );                                                                                                                                                          |
|                                                    |                                                                                                                                                                  |
|                                                    | **MySQL**:                                                                                                                                                       |
|                                                    |                                                                                                                                                                  |
|                                                    | .. code-block:: sql                                                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    |  SELECT COUNT(o.`Token`)                                                                                                                                         |
|                                                    |  FROM OAuthAccessData o                                                                                                                                          |
|                                                    |  LEFT JOIN Preferences p ON o.                                                                                                                                   |
|                                                    |    clientid = p.name                                                                                                                                             |
|                                                    |    AND o.userid = p.userid                                                                                                                                       |
|                                                    |    AND p.category = 'oauth_app'                                                                                                                                  |
|                                                    |  INNER JOIN Sessions s ON o.token = s                                                                                                                            |
|                                                    |    .token                                                                                                                                                        |
|                                                    |  WHERE p.name IS NULL;                                                                                                                                           |
|                                                    |                                                                                                                                                                  |
|                                                    | Locks on the ``oauthaccessdata`` and sessions table will only be acquired if there are rows to delete.                                                           |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | In v7.9.5, for servers wanting to allow websockets to connect from origins other than the origin of the site URL, please set the                                 |
|                                                    | ``ServiceSettings.AllowCorsFrom``                                                                                                                                |
|                                                    | :ref:`configuration setting <administration-guide/configure/integrations-configuration-settings:enable cross-origin requests from>`. Also ensure that            |
|                                                    | the ``siteURL`` is set correctly.                                                                                                                                |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v7.8                                               | :ref:`Message Priority & Acknowledgement <administration-guide/configure/site-configuration-settings:message priority>` is now enabled by default                |
|                                                    | for all instances. You may disable this feature in the System Console by going to **Posts > Message Priority** or via the config ``PostPriority`` setting.       |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | In v7.8.5, fixed an issue where a user would still see threads in the threads view of channels they have left. Migration execution time in MySQL: Query OK,      |
|                                                    | 2766769 rows affected (4 min 47.57 sec). Migration execution time in PostgreSQL: 58.11 sec, DELETE 2766690.                                                      |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | In v7.8.5, backported a fix related Oauth 2. Query times depend on if you have rows to delete or not.                                                            |
|                                                    |                                                                                                                                                                  |
|                                                    | With no rows to delete:                                                                                                                                          |
|                                                    |                                                                                                                                                                  |
|                                                    | - MySQL v5.7.12: 9ms                                                                                                                                             |
|                                                    | - PostgreSQL v10: 21ms                                                                                                                                           |
|                                                    |                                                                                                                                                                  |
|                                                    | 4 rows:                                                                                                                                                          |
|                                                    |                                                                                                                                                                  |
|                                                    | - MySQL v5.7.12: 17.2ms                                                                                                                                          |
|                                                    | - PostgreSQL v10: 9.9ms                                                                                                                                          |
|                                                    |                                                                                                                                                                  |
|                                                    | Those times are based off the following table sizes:                                                                                                             |
|                                                    |                                                                                                                                                                  |
|                                                    | - Preferences: 2 million records                                                                                                                                 |
|                                                    | - ``oauthaccessdata`` and sessions: 10 records                                                                                                                   |
|                                                    |                                                                                                                                                                  |
|                                                    | You can assess the number of impacted rows by running the following:                                                                                             |
|                                                    |                                                                                                                                                                  |
|                                                    | **PostgreSQL**:                                                                                                                                                  |
|                                                    |                                                                                                                                                                  |
|                                                    | .. code-block:: sql                                                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    |  SELECT count(o.*)                                                                                                                                               |
|                                                    |   FROM oauthaccessdata o                                                                                                                                         |
|                                                    |   WHERE NOT EXISTS (                                                                                                                                             |
|                                                    |      SELECT p.*                                                                                                                                                  |
|                                                    |      FROM preferences p                                                                                                                                          |
|                                                    |      WHERE o.clientid = p.name                                                                                                                                   |
|                                                    |        AND o.userid = p.                                                                                                                                         |
|                                                    |        userid                                                                                                                                                    |
|                                                    |        AND p.category =                                                                                                                                          |
|                                                    |        'oauth_app'                                                                                                                                               |
|                                                    |      );                                                                                                                                                          |
|                                                    |                                                                                                                                                                  |
|                                                    | **MySQL**:                                                                                                                                                       |
|                                                    |                                                                                                                                                                  |
|                                                    | .. code-block:: sql                                                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    |  SELECT COUNT(o.`Token`)                                                                                                                                         |
|                                                    |  FROM OAuthAccessData o                                                                                                                                          |
|                                                    |  LEFT JOIN Preferences p ON o.                                                                                                                                   |
|                                                    |    clientid = p.name                                                                                                                                             |
|                                                    |    AND o.userid = p.userid                                                                                                                                       |
|                                                    |    AND p.category = 'oauth_app'                                                                                                                                  |
|                                                    |  INNER JOIN Sessions s ON o.token = s                                                                                                                            |
|                                                    |    .token                                                                                                                                                        |
|                                                    |  WHERE p.name IS NULL;                                                                                                                                           |
|                                                    |                                                                                                                                                                  |
|                                                    | Locks on the ``oauthaccessdata`` and sessions table will only be acquired if there are rows to delete.                                                           |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | In v7.8.7, for servers wanting to allow websockets to connect from origins other than the origin of the site URL, please set the                                 |
|                                                    | ``ServiceSettings.AllowCorsFrom``                                                                                                                                |
|                                                    | :ref:`configuration setting <administration-guide/configure/integrations-configuration-settings:enable cross-origin requests from>`. Also ensure that            |
|                                                    | the ``siteURL`` is set correctly.                                                                                                                                |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | In v7.8.11, improved performance on data retention ``DeleteOrphanedRows`` queries.                                                                               |
|                                                    |                                                                                                                                                                  |
|                                                    | New migration for a new table:                                                                                                                                   |
|                                                    |                                                                                                                                                                  |
|                                                    | **MySQL**:                                                                                                                                                       |
|                                                    |                                                                                                                                                                  |
|                                                    | .. code-block:: sql                                                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    |  CREATE TABLE                                                                                                                                                    |
|                                                    |                                                                                                                                                                  |
|                                                    |  IF NOT EXISTS                                                                                                                                                   |
|                                                    |    RetentionIdsForDeletion(Id                                                                                                                                    |
|                                                    |      VARCHAR(26) NOT NULL,                                                                                                                                       |
|                                                    |      TableName VARCHAR(64),                                                                                                                                      |
|                                                    |      Ids json, PRIMARY KEY (Id                                                                                                                                   |
|                                                    |        ), KEY                                                                                                                                                    |
|                                                    |      idx_retentionidsfordeletion_tablename                                                                                                                       |
|                                                    |      (TableName)) ENGINE =                                                                                                                                       |
|                                                    |    InnoDB DEFAULT CHARSET =                                                                                                                                      |
|                                                    |    utf8mb4;                                                                                                                                                      |
|                                                    |    ``                                                                                                                                                            |
|                                                    |                                                                                                                                                                  |
|                                                    | **PostgreSQL**:                                                                                                                                                  |
|                                                    |                                                                                                                                                                  |
|                                                    | .. code-block:: sql                                                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    |  CREATE TABLE                                                                                                                                                    |
|                                                    |                                                                                                                                                                  |
|                                                    |  IF NOT EXISTS                                                                                                                                                   |
|                                                    |    retentionidsfordeletion(id                                                                                                                                    |
|                                                    |      VARCHAR(26) PRIMARY KEY,                                                                                                                                    |
|                                                    |      tablename VARCHAR(64),                                                                                                                                      |
|                                                    |      ids VARCHAR(26) []);                                                                                                                                        |
|                                                    |    CREATE INDEX                                                                                                                                                  |
|                                                    |                                                                                                                                                                  |
|                                                    |  IF NOT EXISTS                                                                                                                                                   |
|                                                    |    idx_retentionidsfordeletion_tablename                                                                                                                         |
|                                                    |    ON retentionidsfordeletion(                                                                                                                                   |
|                                                    |      tablename);                                                                                                                                                 |
|                                                    |    ``                                                                                                                                                            |
|                                                    |                                                                                                                                                                  |
|                                                    | Hard deleting a user or a channel will now also clean up associated reactions.                                                                                   |
|                                                    |                                                                                                                                                                  |
|                                                    | Removed feature flag ``DataRetentionConcurrencyEnabled``. Data retention now runs without concurrency in order to avoid any performance degradation.             |
|                                                    |                                                                                                                                                                  |
|                                                    | Added a new configuration setting ``DataRetentionSettings.RetentionIdsBatchSize``, which allows admins to configure how many batches of IDs will be fetched at   |
|                                                    | a time when deleting orphaned reactions. The default value is 100.                                                                                               |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v7.7                                               | Plugins with a webapp component may need to be updated to work with Mattermost v7.7 release and the updated ``React v17`` dependency.                            |
|                                                    |                                                                                                                                                                  |
|                                                    | This is to avoid plugins crashing with an error about ``findDOMNode`` being called on an unmounted component. While our                                          |
|                                                    | `starter template <https://github.com/mattermost/mattermost-plugin-starter-template>`_ depended on an external version of ``React``, it did not do the same for  |
|                                                    | ``ReactDOM``. Plugins need to update their ``webpack.config.js`` directives to externalize ``ReactDOM``. For reference, see                                      |
|                                                    | https://github.com/mattermost/mattermost-plugin-playbooks/pull/1489. Server-side only plugins are unaffected. This change can be done for existing plugins any   |
|                                                    | time prior to upgrading to Mattermost v7.7 and is backwards compatible with older versions of Mattermost. If you run into issues, you can either enable          |
|                                                    | ``ExperimentalSettings.PatchPluginsReactDOM`` or just disable the affected plugin while it's updated.                                                            |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Denormalized ``Threads`` table by adding the ``ThreadTeamId`` column. Even though it denormalizes the schema, we gain performance by removing the unnessesary    |
|                                                    | joins.                                                                                                                                                           |
|                                                    |                                                                                                                                                                  |
|                                                    | Test results for schema changes are outlined below:                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    | instance: ``db.r5.large``                                                                                                                                        |
|                                                    |                                                                                                                                                                  |
|                                                    | size of ``Threads`` table: 846313 rows                                                                                                                           |
|                                                    |                                                                                                                                                                  |
|                                                    | number of posts: 12 million                                                                                                                                      |
|                                                    |                                                                                                                                                                  |
|                                                    | number of reactions: 2.5 million                                                                                                                                 |
|                                                    |                                                                                                                                                                  |
|                                                    | **MySQL:**                                                                                                                                                       |
|                                                    |                                                                                                                                                                  |
|                                                    | .. code-block:: sql                                                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    |  -- Drop any existing TeamId column from 000094_threads_teamid.up.sql                                                                                            |
|                                                    |                                                                                                                                                                  |
|                                                    |  SET @preparedStatement = (SELECT IF(                                                                                                                            |
|                                                    |      EXISTS(``                                                                                                                                                   |
|                                                    |          SELECT 1 FROM INFORMATION_SCHEMA.STATISTICS                                                                                                             |
|                                                    |          WHERE table_name = 'Threads'                                                                                                                            |
|                                                    |          AND table_schema = DATABASE()                                                                                                                           |
|                                                    |          AND column_name = 'TeamId'                                                                                                                              |
|                                                    |      ),                                                                                                                                                          |
|                                                    |      'ALTER TABLE Threads DROP COLUMN TeamId;',                                                                                                                  |
|                                                    |      'SELECT 1;'                                                                                                                                                 |
|                                                    |  ));                                                                                                                                                             |
|                                                    |                                                                                                                                                                  |
|                                                    |  PREPARE removeColumnIfExists FROM @preparedStatement;                                                                                                           |
|                                                    |  EXECUTE removeColumnIfExists;                                                                                                                                   |
|                                                    |  DEALLOCATE PREPARE removeColumnIfExists;                                                                                                                        |
|                                                    |                                                                                                                                                                  |
|                                                    |  SET @preparedStatement = (SELECT IF(                                                                                                                            |
|                                                    |      NOT EXISTS(                                                                                                                                                 |
|                                                    |          SELECT 1 FROM INFORMATION_SCHEMA.COLUMNS                                                                                                                |
|                                                    |          WHERE table_name = 'Threads'                                                                                                                            |
|                                                    |          AND table_schema = DATABASE()                                                                                                                           |
|                                                    |          AND column_name = 'ThreadTeamId'                                                                                                                        |
|                                                    |                                                                                                                                                                  |
|                                                    |      ),                                                                                                                                                          |
|                                                    |      'ALTER TABLE Threads ADD COLUMN ThreadTeamId varchar(26) DEFAULT NULL;',                                                                                    |
|                                                    |      'SELECT 1;'                                                                                                                                                 |
|                                                    |  ));                                                                                                                                                             |
|                                                    |                                                                                                                                                                  |
|                                                    |  PREPARE addColumnIfNotExists FROM @preparedStatement;                                                                                                           |
|                                                    |  EXECUTE addColumnIfNotExists;                                                                                                                                   |
|                                                    |  DEALLOCATE PREPARE addColumnIfNotExists;                                                                                                                        |
|                                                    |                                                                                                                                                                  |
|                                                    |  Query OK, 0 rows affected (7.71 sec)                                                                                                                            |
|                                                    |                                                                                                                                                                  |
|                                                    |  UPDATE Threads, Channels                                                                                                                                        |
|                                                    |  SET Threads.ThreadTeamId = Channels.TeamId                                                                                                                      |
|                                                    |  WHERE Channels.Id = Threads.ChannelId                                                                                                                           |
|                                                    |  AND Threads.ThreadTeamId IS NULL;                                                                                                                               |
|                                                    |                                                                                                                                                                  |
|                                                    |  Query OK, 846313 rows affected (51.32 sec)                                                                                                                      |
|                                                    |                                                                                                                                                                  |
|                                                    |  Rows matched: 846313 Changed: 846313 Warnings: 0                                                                                                                |
|                                                    |                                                                                                                                                                  |
|                                                    | **PostgreSQL:**                                                                                                                                                  |
|                                                    |                                                                                                                                                                  |
|                                                    | .. code-block:: sql                                                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    |  -- Drop any existing TeamId column from 000094_threads_teamid.up.sql                                                                                            |
|                                                    |                                                                                                                                                                  |
|                                                    |  ALTER TABLE threads DROP COLUMN IF EXISTS teamid;                                                                                                               |
|                                                    |                                                                                                                                                                  |
|                                                    |  ALTER TABLE threads ADD COLUMN IF NOT EXISTS threadteamid VARCHAR(26);                                                                                          |
|                                                    |                                                                                                                                                                  |
|                                                    |  ALTER TABLE                                                                                                                                                     |
|                                                    |                                                                                                                                                                  |
|                                                    |  Time: 2.236 ms                                                                                                                                                  |
|                                                    |                                                                                                                                                                  |
|                                                    |  UPDATE threads                                                                                                                                                  |
|                                                    |  SET threadteamid = channels.                                                                                                                                    |
|                                                    |    teamid                                                                                                                                                        |
|                                                    |  FROM channels                                                                                                                                                   |
|                                                    |  WHERE threads.threadteamid IS                                                                                                                                   |
|                                                    |    NULL                                                                                                                                                          |
|                                                    |    AND channels.id = threads.                                                                                                                                    |
|                                                    |    channelid;                                                                                                                                                    |
|                                                    |                                                                                                                                                                  |
|                                                    |  UPDATE 847646                                                                                                                                                   |
|                                                    |                                                                                                                                                                  |
|                                                    |  Time: 29744.608 ms (00:29.745)                                                                                                                                  |
|                                                    |                                                                                                                                                                  |
|                                                    |  **Backwards-compatibility:**                                                                                                                                    |
|                                                    |                                                                                                                                                                  |
|                                                    |  A previous version of Mattermost can run with the new schema changes                                                                                            |
|                                                    |                                                                                                                                                                  |
|                                                    |  **Table locks or impact to existing operations on the table:**                                                                                                  |
|                                                    |                                                                                                                                                                  |
|                                                    |  Table locks - Threads table                                                                                                                                     |
|                                                    |                                                                                                                                                                  |
|                                                    | Queries posted above can be run prior to upgrading Mattermost for both MySQL and PostgreSQL. After schema changes migration becomes instantaneous (0.78 sec).    |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Starting with the Calls version shipping with v7.7, there's now a minimum version requirement when using the external RTCD service. This means that if Calls is  |
|                                                    | configured to use the external service, customers need to upgrade RTCD first to at least version 0.8.0 or the plugin will fail to start.                         |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | In v7.7.2, :ref:`Message Priority & Acknowledgement <administration-guide/configure/site-configuration-settings:message priority>` is now enabled by             |
|                                                    | default for all instances. You may disable this feature in the System Console by going to **Posts > Message Priority** or via the config ``PostPriority``        |
|                                                    | setting.                                                                                                                                                         |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v7.5                                               | Added a new schema migration to ensure ``ParentId`` column is dropped from the ``Posts`` table. Depending on the table size, if the column is not dropped        |
|                                                    | before, a significant spike in database CPU usage is expected on MySQL databases. Writes to the table will be limited during the migration.                      |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | For ``PluginRegistry.registerCustomRoute``, when you register a custom route component, you must specify a CSS ``grid-area`` in order for it to be placed        |
|                                                    | properly into the root layout (recommended: ``grid-area: center``).                                                                                              |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v7.3                                               | Boards is moving from a channel-based to a role-based permissions system. The migration will happen automatically, but your administrator should perform a       |
|                                                    | backup prior to the upgrade. We removed workspaces, so if you were a member of many boards prior to migration, they will now all appear under the same sidebar.  |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v7.2                                               | Several schema changes impose additional database constraints to make the data more strict. All the commands listed below were tested on a 8 core, 16GB RAM      |
|                                                    | machine. Here are the times recorded:                                                                                                                            |
|                                                    |                                                                                                                                                                  |
|                                                    | **PostgreSQL (131869 channels, 2 teams)**:                                                                                                                       |
|                                                    |                                                                                                                                                                  |
|                                                    | - ``CREATE TYPE channel_type AS ENUM ('P', 'G', 'O', 'D');`` took 14.114 milliseconds                                                                            |
|                                                    | - ``ALTER TABLE channels alter column type type channel_type using type::channel_type;`` took 3856.790 milliseconds (3.857 seconds)                              |
|                                                    | - ``CREATE TYPE team_type AS ENUM ('I', 'O');`` took 4.191 milliseconds                                                                                          |
|                                                    | - ``ALTER TABLE teams alter column type type team_type using type::team_type;`` took 116.205 milliseconds                                                        |
|                                                    | - ``CREATE TYPE upload_session_type AS ENUM ('attachment', 'import');`` took 4.266 milliseconds                                                                  |
|                                                    | - ``ALTER TABLE uploadsessions alter column type type upload_session_type using type::upload_session_type;`` took 37.099 milliseconds                            |
|                                                    |                                                                                                                                                                  |
|                                                    | **MySQL (270959 channels, 2 teams)**:                                                                                                                            |
|                                                    |                                                                                                                                                                  |
|                                                    | - ``ALTER TABLE Channels MODIFY COLUMN Type ENUM("D", "O", "G", "P");`` took 13.24 seconds                                                                       |
|                                                    | - ``ALTER TABLE Teams MODIFY COLUMN Type ENUM("I", "O");`` took 0.04 seconds                                                                                     |
|                                                    | - ``ALTER TABLE UploadSessions MODIFY COLUMN Type ENUM("attachment", "import");`` took 0.03 seconds                                                              |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v7.1                                               | A new configuration option ``MaxImageDecoderConcurrency`` indicates how many images can be decoded concurrently at once. The default is -1, and the value        |
|                                                    | indicates the number of CPUs present. This affects the total memory consumption of the server. The maximum memory of a single image is dictated by               |
|                                                    | ``MaxImageResolution * 24 bytes``. Therefore, we recommend that ``MaxImageResolution * MaxImageDecoderConcurrency * 24`` should be less than the allocated       |
|                                                    | memory for image decoding.                                                                                                                                       |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Mattermost v7.1 introduces schema changes in the form of a new column and its index. Our test results for the schema changes are included below:                 |
|                                                    |                                                                                                                                                                  |
|                                                    | - MySQL 12M Posts, 2.5M Reactions - ~1min 34s (instance: PC with 8 cores, 16GB RAM)                                                                              |
|                                                    | - PostgreSQL 12M Posts, 2.5M Reactions - ~1min 18s (instance: db.r5.2xlarge)                                                                                     |
|                                                    |                                                                                                                                                                  |
|                                                    | You can run the following SQL queries before the upgrade to obtain a lock on ``Reactions`` table, so that users' reactions posted during this time won't be      |
|                                                    | reflected in the database until the migrations are complete. This is fully backwards-compatible.                                                                 |
|                                                    |                                                                                                                                                                  |
|                                                    | MySQL:                                                                                                                                                           |
|                                                    |                                                                                                                                                                  |
|                                                    | - ``ALTER TABLE Reactions ADD COLUMN ChannelId varchar(26) NOT NULL DEFAULT "";``                                                                                |
|                                                    | - ``UPDATE Reactions SET ChannelId = COALESCE((select ChannelId from Posts where Posts.Id = Reactions.PostId), '') WHERE ChannelId="";``                         |
|                                                    | - ``CREATE INDEX idx_reactions_channel_id ON Reactions(ChannelId) LOCK=NONE;``                                                                                   |
|                                                    |                                                                                                                                                                  |
|                                                    | PostgreSQL:                                                                                                                                                      |
|                                                    |                                                                                                                                                                  |
|                                                    | - ``ALTER TABLE reactions ADD COLUMN IF NOT EXISTS channelid varchar(26) NOT NULL DEFAULT '';``                                                                  |
|                                                    | - ``UPDATE reactions SET channelid = COALESCE((select channelid from posts where posts.id = reactions.postid), '') WHERE channelid='';``                         |
|                                                    | - ``CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_reactions_channel_id on reactions (channelid);``                                                                 |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v7.0                                               | **IMPORTANT:** Session length configuration settings have changed from using a unit of *days* to *hours*. Instances using a config.json file or a database       |
|                                                    | configuration for the following values should be automatically migrated to the new units, but instances using environment variables must make the following      |
|                                                    | changes:                                                                                                                                                         |
|                                                    |                                                                                                                                                                  |
|                                                    | 1. replace ``MM_SERVICESETTINGS_SESSIONLENGTHWEBINDAYS`` with ``MM_SERVICESETTINGS_SESSIONLENGTHWEBINHOURS`` (x24 the value).                                    |
|                                                    | 2. replace ``MM_SERVICESETTINGS_SESSIONLENGTHMOBILEINDAYS`` with ``MM_SERVICESETTINGS_SESSIONLENGTHMOBILEINHOURS`` (x24 the value).                              |
|                                                    | 3. replace ``MM_SERVICESETTINGS_SESSIONLENGTHSSOINDAYS`` with ``MM_SERVICESETTINGS_SESSIONLENGTHSSOINHOURS`` (x24 the value).                                    |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | MySQL self-hosted customers may notice the migration taking longer than usual when having a large number of rows in FileInfo table. For MySQL, it takes around   |
|                                                    | 19 seconds for a table of size 700,000 rows. The time required for PostgreSQL is negligible. The testing was performed on a machine with specifications of       |
|                                                    | ``CPU - Intel i7 6-cores @ 2.6 GHz`` and ``Memory - 16 GB``.                                                                                                     |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | When a new configuration setting via **System Console > Experimental > Features > Enable App Bar** is enabled, all channel header icons registered by plugins    |
|                                                    | will be moved to the new Apps Bar, even if they do not explicitly use the new registry function to render a component there. The setting for Apps Bar defaults   |
|                                                    | to ``false`` for self-hosted deployments.                                                                                                                        |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | The value of ``ServiceSettings.TrustedProxyIPHeader`` defaults to empty from now on. A previous bug prevented this from happening in certain conditions.         |
|                                                    | Customers are requested to check for these values in their config and set them to nil if necessary. See more details                                             |
|                                                    | :ref:`here <administration-guide/configure/environment-configuration-settings:trusted proxy ip header>`.                                                         |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | :doc:`Collapsed Reply Threads </end-user-guide/collaborate/organize-conversations>` is now generally available and enabled by default for new                    |
|                                                    | Mattermost servers. For servers upgrading to v7.0 and later, please reference                                                                                    |
|                                                    | `this article <https://support.mattermost.com/hc/en-us/articles/6880701948564-Administrator-s-guide-to-enabling-Collapsed-Reply-Threads>`_ for more information  |
|                                                    | and guidance on enabling the feature.                                                                                                                            |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v6.7                                               | New schema changes were introduced in the form of a new index. The following summarizes the test results measuring how long it took for the database queries to  |
|                                                    | run with these schema changes:                                                                                                                                   |
|                                                    |                                                                                                                                                                  |
|                                                    | MySQL 7M Posts - ~17s (Instance: db.r5.xlarge)                                                                                                                   |
|                                                    |                                                                                                                                                                  |
|                                                    | MySQL 9M Posts - 2min 12s (Instance: db.r5.large)                                                                                                                |
|                                                    |                                                                                                                                                                  |
|                                                    | Postgres 7M Posts - ~9s  (Instance: db.r5.xlarge)                                                                                                                |
|                                                    |                                                                                                                                                                  |
|                                                    | For customers wanting a zero downtime upgrade, they are encouraged to apply this index prior to doing the upgrade. This is fully backwards compatible and will   |
|                                                    | not acquire any table lock or affect any existing operations on the table when run manually. Else, the queries will run during the upgrade process and will lock |
|                                                    | the table in non-MySQL environments. Run the following to apply this index:                                                                                      |
|                                                    |                                                                                                                                                                  |
|                                                    | For MySQL: ``CREATE INDEX idx_posts_create_at_id on Posts(CreateAt, Id) LOCK=NONE;``                                                                             |
|                                                    |                                                                                                                                                                  |
|                                                    | For Postgres: ``CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_posts_create_at_id on posts(createat, id);``                                                         |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | In v6.7.1, the value of ``ServiceSettings.TrustedProxyIPHeader`` defaults to empty from now on. A previous bug prevented this from happening in certain          |
|                                                    | conditions. Customers are requested to check for these values in their config and set them to nil if necessary. See more details                                 |
|                                                    | :ref:`here <administration-guide/configure/environment-configuration-settings:trusted proxy ip header>`.                                                         |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v6.6                                               | The Apps Framework protocol  for binding/form submissions has changed, by separating the single `call` into separate `submit`, `form`, `refresh` and `lookup`    |
|                                                    | calls. If any users have created their own Apps, they have to be updated to the new system.                                                                      |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Channel admins can now configure :doc:`certain actions </end-user-guide/collaborate/create-channels>` to be executed automatically based on trigger              |
|                                                    | conditions without writing any code. Users running an older Playbooks release need to upgrade their Playbooks instance to at least v1.26 to take advantage of    |
|                                                    | the channel actions functionality.                                                                                                                               |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | In v6.6.2, the value of ``ServiceSettings.TrustedProxyIPHeader`` defaults to empty from now on. A previous bug prevented this from happening in certain          |
|                                                    | conditions. Customers are requested to check for these values in their config and set them to nil if necessary. See more details                                 |
|                                                    | :ref:`here <administration-guide/configure/environment-configuration-settings:trusted proxy ip header>`.                                                         |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v6.5                                               | The ``mattermost version`` CLI command does not interact with the database anymore. Therefore the database version is not going to be                            |
|                                                    | printed. Also, the database migrations are not going to be applied with the version sub command.                                                                 |
|                                                    | :ref:`A new db migrate sub command <administration-guide/manage/command-line-tools:mattermost db migrate>` is added to enable administrators                     |
|                                                    | to trigger migrations.                                                                                                                                           |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | In v6.5.2, the value of ``ServiceSettings.TrustedProxyIPHeader`` defaults to empty from now on. A previous bug prevented this from happening in certain          |
|                                                    | conditions. Customers are requested to check for these values in their config and set them to nil if necessary. See more details                                 |
|                                                    | :ref:`here <administration-guide/configure/environment-configuration-settings:trusted proxy ip header>`.                                                         |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v6.4                                               | A new schema migration system has been introduced, so we strongly recommend backing up the database before updating the server to this version. The new          |
|                                                    | migration system will run through all existing migrations to record them to a new table. This will only happen for the first run in order to migrate the         |
|                                                    | application to the new system. The table where the migration information is stored is called ``db_migrations``. Additionally, a ``db_lock`` table is used to     |
|                                                    | prevent multiple installations from running migrations in parallel. In case of an error while applying the migrations, please check this table first.  Any       |
|                                                    | downtime depends on how many records the database has and whether there are missing migrations in the schema. If you encounter an issue please file              |
|                                                    | `an Issue <https://github.com/mattermost/mattermost-server/issues>`_ by including the failing migration name, database driver/version, and the server logs.      |
|                                                    |                                                                                                                                                                  |
|                                                    | On MySQL, if you encounter an error "Failed to apply database migrations" when upgrading to v6.4.0, it means that there is a mismatch between the                |
|                                                    | table collation and the default database collation. You can manually fix this by changing the database collation with                                            |
|                                                    | ``ALTER DATABASE <YOUR_DB_NAME> COLLATE = 'utf8mb4_general_ci',``. Then do the server upgrade again and the migration will be successful.                        |
|                                                    |                                                                                                                                                                  |
|                                                    | It has been commonly observed on MySQL 8+ systems to have an error ``Error 1267: Illegal mix of collations`` when upgrading due to changing the default          |
|                                                    | collation. This is caused by the database and the tables having different collations. If you get this error, please change the collations to have the same       |
|                                                    | value with, for example, ``ALTER DATABASE <db_name> COLLATE = '<collation>'``.                                                                                   |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | The new migration system requires the MySQL database user to have additional *EXECUTE*, *CREATE ROUTINE*, *ALTER ROUTINE* and *REFERENCES* privileges to run     |
|                                                    | schema migrations.                                                                                                                                               |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v6.3                                               | In v6.3.3, the default for ``ThreadAutoFollow`` has been changed to ``false``. This does not affect existing configurations where this value is already set to   |
|                                                    | ``true``.                                                                                                                                                        |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | In v6.3.9, the value of ``ServiceSettings.TrustedProxyIPHeader`` defaults to empty from now on. A previous bug prevented this from happening in certain          |
|                                                    | conditions. Customers are requested to check for these values in their config and set them to nil if necessary. See more details                                 |
|                                                    | :ref:`here <administration-guide/configure/environment-configuration-settings:trusted proxy ip header>`.                                                         |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v6.2                                               | Channel results in the channel autocomplete will include private channels. Customers using :doc:`Bleve </administration-guide/configure/bleve-search>` or        |
|                                                    | :doc:`Elasticsearch </administration-guide/scale/elasticsearch-setup>` for autocomplete will have to reindex their data to get the new results. Since this can   |
|                                                    | take a long time, we suggest disabling autocomplete and running indexing in the background. When this is complete, re-enable autocomplete.                       |
|                                                    |                                                                                                                                                                  |
|                                                    | .. note::                                                                                                                                                        |
|                                                    |  Only channel members see private channel names in autocomplete results.                                                                                         |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | In v6.2.3, the default for ``ThreadAutoFollow`` has been changed to ``false``. This does not affect existing configurations where this value is already set to   |
|                                                    | ``true``.                                                                                                                                                        |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Mattermost Boards requires ``EnableReliableWebSockets`` setting to be manually set to ``true`` for real-time updates to appear correctly.                        |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v6.1                                               | Please refer to `the schema migration analysis <https://gist.github.com/streamer45/997b726a86b5d2a624ac2af435a66086>`_ when upgrading to v6.1.                   |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | The Bleve index has been updated to use the scorch index type. This new default index type features some efficiency improvements which means that the indexes    |
|                                                    | use significantly less disk space. To use this new type of index, after upgrading the server version, run a purge operation and then a reindex from the Bleve    |
|                                                    | section of the System Console. Bleve is still compatible with the old indexes, so the currently indexed data will work fine if the purge and reindex is not run. |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | A composite index has been added to the jobs table for better query performance. For some customers with a large jobs table, this can take a long time, so we    |
|                                                    | recommend adding the index during off-hours, and then running the migration. A table with more than 1 million rows can be considered as large enough to be       |
|                                                    | updated prior to the upgrade.                                                                                                                                    |
|                                                    |                                                                                                                                                                  |
|                                                    | - For PostgreSQL: ``create index concurrently idx_jobs_status_type on jobs (status,type);``                                                                      |
|                                                    | - For MySQL: ``create index idx_jobs_status_type on Jobs (Status,Type);``                                                                                        |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | In v6.1.3, the default for ``ThreadAutoFollow`` has been changed to ``false``. This does not affect existing configurations where this value is already set to   |
|                                                    | ``true``.                                                                                                                                                        |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Mattermost Boards requires ``EnableReliableWebSockets`` setting to be manually set to ``true`` for real-time updates to appear correctly.                        |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v6.0                                               | Longer migration times can be expected.                                                                                                                          |
|                                                    |                                                                                                                                                                  |
|                                                    | - See `this document <https://gist.github.com/streamer45/59b3582118913d4fc5e8ff81ea78b055>`__ for the estimated upgrade times with datasets of 10+ million posts.|
|                                                    | - See `this document <https://gist.github.com/streamer45/868c451164f6e8069d8b398685a31b6e>`__ for the estimated upgrade times with datasets of 70+ million posts.|
|                                                    |                                                                                                                                                                  |
|                                                    | The field type of Data in ``model.ClusterMessage`` was changed to []byte from string. A v6 server is incompatible to run along with a v5 server in a cluster.    |
|                                                    | Customers upgrading from 5.x to 6.x cannot do a High Availability upgrade. While upgrading, it is required that no other v5 server runs when a v6 server is      | 
|                                                    | brought up. A v6 server will run significant database schema changes that can cause a large startup time depending on the dataset size.                          |
|                                                    | Zero downtime will not be possible, but depending on the efforts made during the migration process, it can be minimized to a large extent.                       |
|                                                    |                                                                                                                                                                  |
|                                                    | 1. Low effort, long downtime - This is the usual process of starting a v6 server normally. This has two implications: during the migration process, various      |
|                                                    | tables will be locked which will render those tables read-only during that period. Secondly, once the server finishes migration and starts the application, no   |
|                                                    | other v5 server can run in the cluster.                                                                                                                          |
|                                                    |                                                                                                                                                                  |
|                                                    | 2. Medium effort, medium downtime - This process will require SQL queries to be executed manually on the server. To avoid causing a table lock, a customer can   |
|                                                    | choose to use the pt-online-schema-change tool for MySQL. For Postgres, the table locking is very minimal. The advantage is that since there are a lot of        |
|                                                    | queries, the customer can take their own time to run individual queries during off-hours. All queries except #11 are safe to be executed this way. Then the      |
|                                                    | usual method of (1) can be followed.                                                                                                                             |
|                                                    |                                                                                                                                                                  |
|                                                    | 3. High effort, low downtime - This process requires everything of (2), plus it tries to minimize the impact of query #11. We can do this by following step 2,   |
|                                                    | and then starting v6 along with a running v5 server, and then monitor the application logs. As soon as the v6 application starts up, we need to bring down a v5  |
|                                                    | node. This minimizes the downtime to only a few seconds.                                                                                                         |
|                                                    |                                                                                                                                                                  |
|                                                    | It is recommended to start Mattermost directly and not through systemctl to avoid the server process getting killed during the migration. This can happen since  |
|                                                    | the value of ``TimeoutStartSec`` in the provided systemctl service file is set to one hour.                                                                      |
|                                                    |                                                                                                                                                                  |
|                                                    | Customers using the Mattermost Kubernetes operator should be aware of the above migration information and choose the path that is most appropriate for them. If  |
|                                                    | (1) is acceptable, then the normal upgrade process using the operator will suffice. For minimum downtime, follow (2) before using the operator to update         |
|                                                    | Mattermost following the normal upgrade process.                                                                                                                 |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | While trying to upgrade to a Mattermost version >= 6.0.x, you might encounter the following error: ``Failed to alter column type. It is likely you have invalid  |
|                                                    | JSON values in the column. Please fix the values manually and run the migration again.``                                                                         |
|                                                    |                                                                                                                                                                  |
|                                                    | This means that the particular column has some invalid JSON values which need to be fixed manually. A common fix that is known to work is to wipe out all        |
|                                                    | ``\u0000`` characters.                                                                                                                                           |
|                                                    |                                                                                                                                                                  |
|                                                    | Please follow these steps:                                                                                                                                       |
|                                                    |                                                                                                                                                                  |
|                                                    | 1. Check the affected values by: ``SELECT COUNT(*) FROM <table> WHERE <column> LIKE '%\u0000%';``                                                                |
|                                                    | 2. If you get a count more than 0, check those values manually, and confirm they are okay to be removed.                                                         |
|                                                    | 3. Remove them by ``UPDATE <table> SET <column> = regexp_replace(<column>, '\\u0000', '', 'g') where <column> like '%\u0000%';``                                 |
|                                                    |                                                                                                                                                                  |
|                                                    | Then try to start Mattermost again.                                                                                                                              |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Please see :doc:`unsupported legacy releases </product-overview/unsupported-legacy-releases>` documentation for a list of deprecations in this release.          |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Focalboard plugin has been renamed to Mattermost Boards, and v0.9.1 (released with Mattermost v6.0) is now enabled by default.                                   |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | The advanced logging configuration schema changed. This is a breaking change relative to 5.x. See updated                                                        |
|                                                    | :doc:`documentation </administration-guide/manage/logging>`.                                                                                                     |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | The existing theme names and colors, including "Mattermost", "Organization", "Mattermost Dark", and "Windows Dark" have been updated to the new "Denim",         |
|                                                    | "Quartz", "Indigo", and "Onyx" theme names and colors, respectively. Anyone using the existing themes will see slightly modified theme colors after their        |
|                                                    | server or workspace is upgraded. The theme variables for the existing "Mattermost", "Organization", "Mattermost Dark", and "Windows Dark" themes will still be   |
|                                                    | accessible in :doc:`our documentation </end-user-guide/preferences/customize-your-theme>`. A custom theme can be created with these theme variables if desired.  |
|                                                    | Custom themes are unaffected by this change.                                                                                                                     |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Some breaking changes to plugins are included:                                                                                                                   |
|                                                    |                                                                                                                                                                  |
|                                                    | - Support for left-hand side-specific bot icons was dropped.                                                                                                     |
|                                                    | - Removed a deprecated "Backend" field from the plugin manifest.                                                                                                 |
|                                                    | - Converted the "Executables" field in the plugin manifest to a map.                                                                                             |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Mattermost Boards requires ``EnableReliableWebSockets`` setting to be manually set to ``true`` for real-time updates to appear correctly.                        |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v5.38.0                                            | The “config watcher” (the mechanism that automatically reloads the ``config.json`` file) has been removed in favor of the ``mmctl config reload`` command, which |
|                                                    | must be run to apply configuration changes after they are made on disk. This change improves configuration performance and robustness.                           |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | v5.38 adds fixes for some of the incorrect mention counts and unreads around threads and channels since the introduction of Collapsed Reply Threads (Beta). This |
|                                                    | fix is done through a SQL migration, and it may take several minutes to complete for large databases. The ``fixCRTChannelMembershipCounts`` fix takes 1 minute   |
|                                                    | and 20 seconds for a database containing approximately four million channel memberships and about 130,000 channels. The ``fixCRTThreadCountsAndUnreads`` fix     |
|                                                    | takes about 3 minutes and 30 seconds for a database containing 56367 threads, 124587 thread memberships, and 220801 channel memberships. These are on MySQL      |
|                                                    | v5.6.51.                                                                                                                                                         |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Focalboard v0.8.2 (released with Mattermost v5.38.0) requires Mattermost v5.37+ due to the new database connection system.                                       |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v5.37.0                                            | The ``platform`` binary and “--platform” flag have been removed. If you are using the “--platform” flag or are using the ``platform`` binary directly to run     |
|                                                    | the Mattermost server application via a systemd file or custom script, you will be required to use only the mattermost binary.                                   |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | `Collapsed Reply Threads <https://mattermost.com/blog/collapsed-reply-threads-beta/>`__ are available as Beta in Mattermost Server                               |
|                                                    | v5.37 and later. It’s expected that you may experience bugs as we stabilize the feature. In particular, please be aware of                                       |
|                                                    | :ref:`the known issues documented here <end-user-guide/collaborate/organize-conversations:known issues>`.                                                        |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | v5.37 adds support for emoji standard v13.0. If you have added a custom emoji in the past that uses one of the new system names, then it is going to get         |
|                                                    | overwritten by the system emoji. The workaround is to change the custom emoji name.                                                                              |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Parts of Incident Collaboration are now available to all Mattermost editions. As part of this update, Incident Collaboration will require a minimum server       |
|                                                    | version of v5.37. To learn more about what is available in each edition, visit `our pricing page <https://mattermost.com/pricing>`_.                             |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | In v5.37.8, the default for ``ThreadAutoFollow`` has been changed to ``false``. This does not affect existing configurations where this value is already set to  |
|                                                    | ``true``.                                                                                                                                                        |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v5.36.0                                            | Gossip clustering mode is now in General Availability and is no longer available as an option. All cluster traffic will always use the gossip protocol. The      |
|                                                    | config setting ``UseExperimentalGossip`` has no effect and has only been kept for compatibility purposes. The setting to use gossip has been removed from the    |
|                                                    | System Console.                                                                                                                                                  |
|                                                    |                                                                                                                                                                  |
|                                                    | .. note::                                                                                                                                                        |
|                                                    |                                                                                                                                                                  |
|                                                    |  For High Availability upgrades, all nodes in the cluster must use a single protocol. If an existing system is not currently using                               |
|                                                    |  gossip, one node in a cluster can't be upgraded while other nodes in the cluster use an older version. Customers must either use gossip for their High          |
|                                                    |  Availability upgrade, or customers must shut down all nodes, perform the upgrade, and then bring all nodes back up.                                             |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | To enable Focalboard, open the Marketplace from the sidebar menu, install the Focalboard plugin, then click on **Configure**, enable it, and save. Update your   |
|                                                    | NGINX or Apache web proxy config.                                                                                                                                |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v5.35.0                                            | Due to the introduction of backend database architecture required for upcoming new features, Shared Channels and Collapsed Reply Threads, the performance of the |
|                                                    | migration process for the v5.35 release (May 16, 2021) has been noticeably affected. Depending on the size, type, and version of the database, longer than usual |
|                                                    | upgrade times should be expected. This can vary from a couple of minutes (average case) to hours (worst case, MySQL 5.x only). A moderate to significant spike   |
|                                                    | in database CPU usage should also be expected during this process.                                                                                               |
|                                                    | More details on the `performance impact of the migration and possible mitigation                                                                                 |
|                                                    | strategies <https://gist.github.com/streamer45/9aee4906639a49ebde68b2f3c0f924c1>`_ are available.                                                                |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | The existing password generation logic used during the bulk user import process was comparatively weak. Hence it's advised for admins to immediately reset the   |
|                                                    | passwords for all the users who were generated during the bulk import process and whose password has not been changed even once.                                 |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | v5.35.0 introduces a new feature to search for files. Search results for files shared in the past may be incomplete until a                                      |
|                                                    | :ref:`content extraction command <administration-guide/manage/mmctl-command-line-tool:mmctl extract>` is executed to extract                                     |
|                                                    | and index the content of files already in the database. Instances running Elasticsearch or Bleve search backends will also need to execute a Bulk Indexing after |
|                                                    | the content extraction is complete. Please see more details in `this blog post <https://mattermost.com/blog/file-search/>`_.                                     |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v5.34.1                                            | v5.34.1 fixes an issue where upgrading to v5.34.0 runs a migration that can cause timeouts on MySQL installations. Upgrading to v5.34.1 may also execute missing |
|                                                    | migrations that were scheduled for v5.32.0. These additions can be lengthy on very big MySQL (version 5.x) installations.                                        |
|                                                    |                                                                                                                                                                  |
|                                                    | - Altering of ``Posts.FileIds`` type (PostgreSQL only)                                                                                                           |
|                                                    | - Added new column ``ThreadMemberships.UnreadMentions``                                                                                                          |
|                                                    | - Added new column ``Channels.Shared``                                                                                                                           |
|                                                    | - Added new column ``Reactions.UpdateAt``                                                                                                                        |
|                                                    | - Added new column ``Reactions.DeleteAt``                                                                                                                        |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v5.33.0                                            | Deleting a reaction is now a soft delete in the ``Reactions`` table. A schema update is required and may take up to 15 seconds on first run with large data sets.|
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | WebSocket handshakes done with HTTP version lower than 1.1 will result in a warning, and the server will transparently upgrade the version to 1.1 to comply with |
|                                                    | the WebSocket RFC. This is done to work around incorrect Nginx (and other proxy) configs that do not set the ``proxy_http_version`` directive to 1.1. This       |
|                                                    | facility will be removed in a future Mattermost version and it is strongly recommended to fix the proxy configuration to correctly use the WebSocket protocol.   |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v5.32.0                                            | ``ExperimentalChannelOrganization``, ``EnableXToLeaveChannelsFromLHS``, ``CloseUnusedDirectMessages``, and ``ExperimentalHideTownSquareinLHS`` settings are only |
|                                                    | functional if the Legacy Sidebar (``EnableLegacySidebar``) is enabled since they are not compatible with the new sidebar experience.                             |
|                                                    | ``ExperimentalChannelSidebarOrganization`` has been deprecated, since the                                                                                        |
|                                                    | `new sidebar is now enabled for all users <https://mattermost.com/blog/custom-collapsible-channel-categories/>`_.                                                |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Breaking changes to the Golang client API were introduced: ``GetPostThread``, ``GetPostsForChannel``, ``GetPostsSince``, ``GetPostsAfter``, ``GetPostsBefore``,  |
|                                                    | and ``GetPostsAroundLastUnread`` now require an additional collapsedThreads parameter to be passed. Any client making use of these functions will need to update |
|                                                    | them when upgrading its dependencies.                                                                                                                            |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | `A breaking change was introduced when upgrading the Go version to v1.15.5 <https://go.dev/doc/go1.15>`_ where user logins fail with AD/LDAP Sync                |
|                                                    | when the certificate of the LDAP Server has no Subject Alternative Name (SAN) in it. Creating a new certificate on the AD/LDAP Server with the SAN inside fixes  |
|                                                    | this.                                                                                                                                                            |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | TLS versions 1.0 and 1.1 have been deprecated by browser vendors. Starting in Mattermost Server v5.32 (February 16), mmctl returns an error when connected to    |
|                                                    | Mattermost servers deployed with these TLS versions. System admins will need to explicitly add a flag in their commands to continue to use them. We recommend    |
|                                                    | upgrading to TLS version 1.2 or higher.                                                                                                                          |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v5.31.0                                            | For Mobile Apps v1.42.0+, the minimum server version is set to v5.31.3 as v5.31.3 fixed an issue where the server version was reported as v5.30.0.               |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v5.29.0                                            | A new configuration setting ``ThreadAutoFollow`` has been added to support Collapsed Reply Threads releasing in beta in Q1 2021.                                 |
|                                                    | This setting is enabled by default and may affect server performance. It is recommended to review our :ref:`documentation on hardware requirements               |
|                                                    | <deployment-guide/software-hardware-requirements:hardware requirements>` to ensure your servers are appropriately scaled for the size of your user base.         |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Disabled the xmlsec1-based SAML library in favor of the re-enabled and improved SAML library.                                                                    |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v5.28.0                                            | Now when the service crashes, it will generate a coredump instead of just dumping the stack trace to the console. This allows us to preserve the full            |
|                                                    | information of the crash to help with debugging it.                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    | For more information about coredumps, please see: https://man7.org/linux/man-pages/man5/core.5.html.                                                             |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | In-product notices have been introduced to keep system admins and end users informed of the latest product enhancements available in new server and desktop      |
|                                                    | versions. :doc:`Learn more about in-product notices </administration-guide/manage/in-product-notices>` and how to disable them in our documentation.             |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Disabled the xmlsec1-based SAML library in favor of the re-enabled and improved SAML library.                                                                    |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v5.27.0                                            | Disabled the xmlsec1-based SAML library in favor of the re-enabled and improved SAML library.                                                                    |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v5.26.0                                            | In v5.26, Elasticsearch indexes needed to be recreated. Admins should re-index Elasticsearch using the **Purge index** and then **Index now** button so that all |
|                                                    | the changes will be included in the index. Systems may be left with a limited search during the indexing, so it should be done during a time when there is       |
|                                                    | little to no activity because it may take several hours.                                                                                                         |
|                                                    +----------------------------------------------------+-------------------------------------------------------------------------------------------------------------+
|                                                    | An ``EnableExperimentalGossipEncryption`` option was added under ``ClusterSettings``. If set to ``true``, and ``UseExperimentalGossip`` is also ``true``,        |
|                                                    | all communication through the cluster using the gossip protocol will be encrypted. The encryption uses ``AES-256`` by default, and it is not kept configurable   |
|                                                    | by design. However, if one wishes, they can set the value in Systems table manually for the ``ClusterEncryptionKey`` row. A key is a byte array converted to     |
|                                                    | base64. It should be either 16, 24, or 32 bytes to select AES-128, AES-192, or AES-256.                                                                          |
|                                                    |                                                                                                                                                                  |
|                                                    | To update the key, one can execute:                                                                                                                              |
|                                                    | ``UPDATE Systems SET Value='<value>' WHERE Name='ClusterEncryptionKey';`` in MySQL and                                                                           |
|                                                    | ``UPDATE systems SET value='<value>' WHERE name='ClusterEncryptionKey'`` for PostgreSQL.                                                                         |
|                                                    |                                                                                                                                                                  |
|                                                    | For any change in this config setting to take effect, the whole cluster must be shut down first. Then the config change made, and then restarted. In a cluster,  |
|                                                    | all servers either will completely use encryption or not. There cannot be any partial usage.                                                                     |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | SAML Setting "Use Improved SAML Library (Beta)" was forcefully disabled.                                                                                         |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | PostgreSQL ended long-term support for `version 9.4 in February 2020 <https://www.postgresql.org/support/versioning>`_. From v5.26 Mattermost officially         |
|                                                    | supports PostgreSQL version 10 as PostgreSQL 9.4 is no longer supported. New installs will require PostgreSQL 10+. Previous Mattermost versions, including our   |
|                                                    | current ESR, will continue to be compatible with PostgreSQL 9.4. PostgreSQL 9.4 and all 9.x versions are now fully deprecated in our v5.30 release               |
|                                                    | (December 16, 2020). Follow the Upgrading Section within `the PostgreSQL documentation <https://www.postgresql.org/support/versioning/>`__.                      |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v5.25.0                                            | Some incorrect instructions regarding SAML setup with Active Directory ADFS for setting the “Relying Party Trust Identifier” were corrected. Although the        |
|                                                    | settings will continue to work, it is encouraged that you                                                                                                        |
|                                                    | :ref:`modify those settings <administration-guide/onboard/sso-saml-adfs-msws2016:add a relying party trust>`.                                                    |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Disabled the xmlsec1-based SAML library in favor of the re-enabled and improved SAML library.                                                                    |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v5.24.0                                            | A new configuration setting, ``ExtendSessionLengthWithActivity`` automatically extends sessions to keep users logged in if they are active in their Mattermost   |
|                                                    | apps. It is recommended to enable this setting to improve user experience if compliant with your organization's policies.                                        |
|                                                    | `Learn more here <https://mattermost.com/blog/session-expiry-experience>`__.                                                                                     |
|                                                    +----------------------------------------------------+-------------------------------------------------------------------------------------------------------------+
|                                                    | The ``mattermost_http_request_duration_seconds`` histogram metric (in Enterprise Edition) has been removed. This information was already captured by             |
|                                                    | ``mattermost_api_time``, which also contains the API handler name, HTTP method, and the response code.                                                           |
|                                                    |                                                                                                                                                                  |
|                                                    | As an example, if you are using                                                                                                                                  |
|                                                    | ``rate(mattermost_http_request_duration_seconds_sum{server=~"$var"}[5m]) /   rate(mattermost_http_request_duration_seconds_count{server=~"$var"}[5m])``          |
|                                                    | to measure average call duration, it needs to be replaced with                                                                                                   |
|                                                    | ``sum(rate(mattermost_api_time_sum{server=~"$var"}[5m])) by (instance) /   sum(rate(mattermost_api_time_count{server=~"$var"}[5m])) by (instance)``.             |
|                                                    +----------------------------------------------------+-------------------------------------------------------------------------------------------------------------+
|                                                    | Due to fixing performance issues related to emoji reactions, the performance of the upgrade has been affected in that the schema upgrade now takes more time in  |
|                                                    | environments with lots of reactions in their database. These environments are recommended to perform the schema migration during low usage times and potentially |
|                                                    | in advance of the upgrade. Since this migration happens before the Mattermost server is fully launched, non-High Availability installs will be unreachable       |
|                                                    | during this time.                                                                                                                                                |
|                                                    |                                                                                                                                                                  |
|                                                    | The migration is a single line of SQL and can be applied directly to the database through the MySQL/PSQL command line clients if you prefer to decouple this     |
|                                                    | from restarting the Mattermost server. It is fully backwards compatible so the schema change can be applied to any previous version of Mattermost without issue. |
|                                                    | During the time the schema change is running (~30s per million rows in the Reactions table), if end users attempt to react to posts, the emoji reactions will    |
|                                                    | not load for end users.                                                                                                                                          |
|                                                    |                                                                                                                                                                  |
|                                                    | MySQL: ``ALTER TABLE Reactions DROP PRIMARY KEY, ADD PRIMARY KEY (PostId, UserId, EmojiName);``                                                                  |
|                                                    |                                                                                                                                                                  |
|                                                    | PostgreSQL: ``ALTER TABLE reactions DROP CONSTRAINT reactions_pkey, ADD PRIMARY KEY (PostId, UserId, EmojiName);``                                               |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | On mobile apps, users will not be able to see LDAP group mentions (E20 feature) in the autocomplete dropdown. Users will still receive notifications if they are |
|                                                    | part of an LDAP group. However, the group mention keyword will not be highlighted.                                                                               |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | SAML Setting "Use Improved SAML Library (Beta)" was forcefully disabled. Follow instructions at                                                                  |
|                                                    | https://docs.mattermost.com/administration-guide/onboard/sso-saml.html for enabling SAML using the feature-equivalent ``xmlsec1`` utility.                       |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v5.22.0                                            | Due to fixing performance issues related to emoji reactions, the performance of the upgrade has been affected in that the schema upgrade now takes more time in  |
|                                                    | environments with lots of reactions in their database. These environments are recommended to perform the schema migration during low usage times and potentially |
|                                                    | in advance of the upgrade. Since this migration happens before the Mattermost server is fully launched, non-High Availability installs will be unreachable       |
|                                                    | during this time.                                                                                                                                                |
|                                                    |                                                                                                                                                                  |
|                                                    | The migration is a single line of SQL and can be applied directly to the database through the MySQL/PSQL command line clients if you prefer to decouple this     |
|                                                    | from restarting the Mattermost server. It is fully backwards compatible so the schema change can be applied to any previous version of Mattermost without issue. |
|                                                    | During the time the schema change is running (~30s per million rows in the Reactions table), if end users attempt to react to posts, the emoji reactions will    |
|                                                    | not load for end users.                                                                                                                                          |
|                                                    |                                                                                                                                                                  |
|                                                    | MySQL: ``ALTER TABLE Reactions DROP PRIMARY KEY, ADD PRIMARY KEY (PostId, UserId, EmojiName);``                                                                  |
|                                                    |                                                                                                                                                                  |
|                                                    | Postgres: ``ALTER TABLE reactions DROP CONSTRAINT reactions_pkey, ADD PRIMARY KEY (PostId, UserId, EmojiName);``                                                 |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | The Channel Moderation Settings feature is supported on mobile app versions v1.30 and later. In earlier versions of the mobile app, users who attempt to post or |
|                                                    | react to posts without proper permissions will see an error.                                                                                                     |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Direct access to the ``Props`` field in the ``model.Post`` structure has been deprecated. The available ``GetProps()`` and ``SetProps()`` methods should now be  |
|                                                    | used. Also, direct copy of the ``model.Post`` structure must be avoided in favor of the provided ``Clone()`` method.                                             |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | SAML Setting "Use Improved SAML Library (Beta)" was forcefully disabled. Follow instructions at                                                                  |
|                                                    | https://docs.mattermost.com/administration-guide/onboard/sso-saml.html for enabling SAML using the feature-equivalent ``xmlsec1`` utility.                       |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v5.21.0                                            | Honour key value expiry in KVCompareAndSet, KVCompareAndDelete, and KVList. We also improved handling of plugin key value race conditions and deleted keys in    |
|                                                    | Postgres.                                                                                                                                                        |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | SAML Setting "Use Improved SAML Library (Beta)" was forcefully disabled. Follow instructions at                                                                  |
|                                                    | https://docs.mattermost.com/administration-guide/onboard/sso-saml.html for enabling SAML using the feature-equivalent ``xmlsec1`` utility.                       |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v5.20.0                                            | Any `pre-packaged plugin <https://developers.mattermost.com/integrate/admin-guide/admin-plugins-beta/#pre-packaged-plugins>`_                                    |
|                                                    | that is not enabled in the ``config.json`` will no longer install automatically, but can continue to be installed via the                                        |
|                                                    | `Plugin Marketplace <https://developers.mattermost.com/integrate/admin-guide/admin-plugins-beta/#plugin-marketplace>`_.                                          |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Boolean elements from interactive dialogs are no longer serialized as strings. While we try to avoid breaking changes, this change was necessary to allow        |
|                                                    | both the web and mobile apps to work with the boolean elements introduced with v5.16.                                                                            |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v5.19.0                                            | ``LockTeammateNameDisplay`` setting was moved to Enterprise Edition E20 as it was erroneously available in Team Edition and Enterprise Edition E10.              |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v5.18.0                                            | Marking a post unread from the mobile app requires v1.26 or later. If using v5.18, but mobile is on v1.25 or earlier, marking a post unread from webapp/desktop  |
|                                                    | will only be reflected on mobile the next time the app launches or is brought to the foreground.                                                                 |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | The Go module path of ``mattermost-server`` was changed to comply with the Go module version specification. Developers using Go modules with                     |
|                                                    | ``mattermost-server`` as a dependency must change the module and import paths to ``github.com/mattermost/mattermost-server/v5`` when upgrade this dependency     |
|                                                    | to `v5.18`. See `<https://go.dev/blog/v2-go-modules>`__ for further information.                                                                                 |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Removed ``Team.InviteId`` from the related Websocket event and sanitized it on all team API endpoints for users without invite permissions.                      |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Removed the ability to change the type of a channel using the ``PUT /channels/{channel_id}`` API endpoint. The new ``PUT /channels/{channel_id}/privacy``        |
|                                                    | endpoint should be used for that purpose.                                                                                                                        |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v5.16.0                                            | Support for Internet Explorer (IE11) is removed. See                                                                                                             |
|                                                    | `this forum post <https://forum.mattermost.com/t/mattermost-is-dropping-support-for-internet-explorer-ie11-in-v5-16/7575>`__ to learn more.                      |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | The `Mattermost Desktop v4.3.0 <https://github.com/mattermost/desktop/blob/master/CHANGELOG.md>`_ release includes a change to how desktop notifications are sent|
|                                                    | sent from non-secure URLs ``http://``. Organizations using non-secure Mattermost Servers ``http://`` will need to update to Mattermost Server versions 5.16.0+,  |
|                                                    | 5.15.1, 5.14.4 or 5.9.5 (ESR) to continue receiving desktop notifications when using Mattermost Desktop v4.3.0 or later.                                         |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | When enabling :doc:`Guest Accounts </administration-guide/onboard/guest-accounts>`, all users who have the ability to invite users will be able to               |
|                                                    | invite guests by default. System admins will need to remove this permission on each role via **System Console > Permissions Schemes**.  In Mattermost Server     |
|                                                    | version 5.17, the system admin will be the only role to automatically get the invite guest permission, however the fix will not be applicable in 5.16 due to     |
|                                                    | database migration processes.                                                                                                                                    |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v5.14.0                                            | Webhooks are now only displayed if the user is the creator of the webhook or a system administrator.                                                             |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | With the update from Google+ to Google People, system admins need to ensure the ``GoogleSettings.Scope`` config.json setting is set to ``profile email`` and     |
|                                                    | ``UserAPIEndpoint`` setting should be set to ``https://people.googleapis.com/v1/people/me?personFields=names,emailAddresses,nicknames,metadata`` per             |
|                                                    | :doc:`updated documentation </administration-guide/onboard/sso-google>`.                                                                                         |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v5.12.0                                            | If your plugin uses the ``DeleteEphemeralMessage`` plugin API, update it to accept a ``postId string`` parameter.                                                |
|                                                    | See `documentation <https://developers.mattermost.com/extend/plugins/server/reference/#API.DeleteEphemeralPost>`__ to learn more.                                |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Image link and YouTube previews do not display unless **System Console > Enable Link Previews** is enabled. Please ensure that your Mattermost server is         |
|                                                    | connected to the internet and has network access to the websites from which previews are expected to appear.                                                     |
|                                                    | `Learn more here <https://forum.mattermost.com/t/link-previews-managed-server-side-in-v5-12-and-later/7712>`__.                                                  |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | ``ExperimentalEnablePostMetadata`` setting was removed. Post metadata, including post dimensions, is now stored in the database to correct scroll position and   |
|                                                    | eliminate scroll jumps as content loads in a channel.                                                                                                            |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Added the ability to enforce the administration of teams/channels with Group Sync. If Group Sync is enabled, all team and channel admin designations will be     |
|                                                    | lost upon upgrade. It is highly recommended that prior to upgrading, Team and channel admins are added to admin-specific LDAP groups corresponding to their      |
|                                                    | teams and channels. After upgrading, those groups will need to be role-synced to the Team or channel admin role.                                                 |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v5.11.0                                            | If your integration uses ``Update.Props == nil`` to clear ``Props``, this will no longer work in 5.11+. Instead, use ``Update.Props == {}`` to clear properties. |
|                                                    |                                                                                                                                                                  |
|                                                    | This change was made because ``Update.Props == nil`` unintentionally cleared all ``Props``, such as the profile picture, instead of preserving them.             |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v5.10.0                                            | ``SupportedTimezonesPath`` setting in config.json and changes to timezones in the UI based on the ``timezones.json`` file was removed. This was made to support  |
|                                                    | :doc:`storing configurations in the database </administration-guide/configure/configuration-in-your-database>`.                                                  |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v5.9.0                                             | If ``DisableLegacyMfa`` setting in ``config.json`` is set to ``true`` and                                                                                        |
|                                                    | :doc:`multi-factor authentication </administration-guide/onboard/multi-factor-authentication>` is enabled, ensure your users have upgraded to mobile app         |
|                                                    | version 1.17 or later. Otherwise, users who have MFA enabled may not be able to log in successfully.                                                             |
|                                                    |                                                                                                                                                                  |
|                                                    | If the setting is not defined in the ``config.json`` file, the ``DisableLegacyMfa`` setting is set to ``false`` by default to ensure no breaking changes.        |
|                                                    |                                                                                                                                                                  |
|                                                    | We recommend setting ``DisableLegacyMfa`` to ``true`` for additional security hardening.                                                                         |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | The public IP of the Mattermost application server is considered a reserved IP for additional security hardening in the context of untrusted external requests   |
|                                                    | such as Open Graph metadata, webhooks, or slash commands.                                                                                                        |
|                                                    | :ref:`See documentation <administration-guide/configure/environment-configuration-settings:allow untrusted internal connections>` for additional information.    |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v5.8.0                                             | The local image proxy has been added, and images displayed within the client are now affected by the ``AllowUntrustedInternalConnections`` setting.              |
|                                                    | :ref:`See documentation <deployment-guide/server/image-proxy:local image proxy>` for more details if you have trouble loading images.                            |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v5.6.0                                             | Built-in WebRTC is removed. See `here for more details <https://forum.mattermost.com/t/built-in-webrtc-video-and-audio-calls-removed-in-v5-6-                    |
|                                                    | in-favor-of-open-source-plugins/5998>`__.                                                                                                                        |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | If ``EnablePublicChannelsMaterialization`` setting in ``config.json`` is set to ``false``, an offline migration prior to upgrade may be required to synchronize  |
|                                                    | the materialized table for public channels to increase channel search performance in the channel switcher (CTRL/CMD+K), channel autocomplete (~), and elsewhere  |
|                                                    | in the UI. Use the following steps:                                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    | 1. Shut down your application servers.                                                                                                                           |
|                                                    | 2. Connect to your Mattermost database.                                                                                                                          |
|                                                    | 3. Execute the following queries:                                                                                                                                |
|                                                    |                                                                                                                                                                  |
|                                                    | .. code-block:: SQL                                                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    |   DELETE FROM PublicChannels;                                                                                                                                    |
|                                                    |   INSERT INTO PublicChannels                                                                                                                                     |
|                                                    |       (Id, DeleteAt, TeamId, DisplayName, Name, Header, Purpose)                                                                                                 |
|                                                    |   SELECT                                                                                                                                                         |
|                                                    |       c.Id, c.DeleteAt, c.TeamId, c.DisplayName, c.Name, c.Header, c.Purpose                                                                                     |
|                                                    |   FROM                                                                                                                                                           |
|                                                    |       Channels c                                                                                                                                                 |
|                                                    |   WHERE                                                                                                                                                          |
|                                                    |       c.Type = 'O';                                                                                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    | The queries above rebuild the materialized ``PublicChannels`` table without modifying the authoritative ``Channels`` table.                                      |
|                                                    |                                                                                                                                                                  |
|                                                    | .. note::                                                                                                                                                        |
|                                                    |                                                                                                                                                                  |
|                                                    |  This migration is not required if the experimental ``PublicChannels`` feature was never disabled. This feature launched in Mattermost v5.4 with a               |
|                                                    |  temporary flag to disable should an issue arise, but nothing prompted doing so. If you did not modify this setting, there is no need to perform this migration. |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v5.4.0                                             | Mattermost mobile app version 1.13+ is required. File uploads will fail on earlier mobile app versions.                                                          |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | In certain upgrade scenarios the new **Allow Team Administrators to edit others posts** setting under **General** then **Users and Teams** may be                |
|                                                    | set to **True** while the Mattermost default in 5.1 and earlier and with new 5.4+ installations is **False**.                                                    |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v5.3.0                                             | Those servers with Elasticsearch enabled will notice that hashtag search is case-sensitive.                                                                      |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v5.2.0                                             | Those servers upgrading from v4.1 - v4.4 directly to v5.2 or later and have Jira enabled will need to re-enable the Jira plugin after an upgrade.                |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v5.1.0                                             | ``mattermost export`` CLI command is renamed to ``mattermost export schedule``. Make sure to update your scripts if you use this command.                        |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v5.0.0                                             | All API v3 endpoints are removed. `See documentation <https://api.mattermost.com/#tag/APIv3-Deprecation>`__ to learn how to migrate your integrations to API v4. |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | ``platform`` binary is renamed to ``mattermost`` for a clearer install and upgrade experience. You should point your ``systemd`` service file at the new         |
|                                                    | ``mattermost`` binary. All command line tools, including the bulk loading tool and developer tools, are also be renamed from ``platform`` to ``mattermost``.     |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | A Mattermost user setting to configure desktop notification duration in **Account Settings > Notifications > Desktop Notifications** is removed.                 |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Slash commands configured to receive a GET request will have the payload being encoded in the query string instead of receiving it in the body of the request,   |
|                                                    | consistent with standard HTTP requests. Although unlikely, this could break custom slash commands that use GET requests incorrectly.                             |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | A new ``config.json`` setting to whitelist types of protocols for auto-linking will be added.                                                                    |
|                                                    | If you rely on custom protocols auto-linking in Mattermost, whitelist them in ``config.json`` before upgrading.                                                  |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | A new ``config.json`` setting to disable the `permanent APIv4 delete team parameter                                                                              |
|                                                    | <https://api.mattermost.com/#tag/teams%2Fpaths%2F~1teams~1%7Bteam_id%7D%2Fput>`__ is added. The setting will be off by default for all new and existing          |
|                                                    | installs, except those deployed on GitLab Omnibus. If you reply on the APIv4 parameter, enable the setting in ``config.json`` before upgrading.                  |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | An unused ``ExtraUpdateAt`` field will be removed from the channel modal.                                                                                        |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | This release includes support for post messages longer than the default of 4000 characters, but may require a manual database migration. This migration is       |
|                                                    | entirely optional, and need only be done if you want to enable post messages up to 16383 characters. For many installations, no migration will be required, or   |
|                                                    | the old limit remains sufficient.                                                                                                                                |
|                                                    |                                                                                                                                                                  |
|                                                    | To check your current post limit after upgrading to 5.0.0, look for a log message on startup:                                                                    |
|                                                    |                                                                                                                                                                  |
|                                                    | ``[2018/03/27 09:08:00 EDT] [INFO] Post.Message supports at most 16383 characters (65535 bytes)``                                                                |
|                                                    |                                                                                                                                                                  |
|                                                    | As of 5.0.0, the maximum post message size is 16383 (multi-byte) characters. If your logs show a number less than this limit and you want to enable longer       |
|                                                    | post messages, you will need to manually migrate your database as described below. This migration can be slow for larger ``Posts`` tables, so it's best to       |
|                                                    | schedule this upgrade during off-peak hours.                                                                                                                     |
|                                                    |                                                                                                                                                                  |
|                                                    | To migrate a MySQL database, connect to your database and run the following:                                                                                     |
|                                                    |                                                                                                                                                                  |
|                                                    | ``ALTER TABLE Posts MODIFY COLUMN Message TEXT;``                                                                                                                |
|                                                    |                                                                                                                                                                  |
|                                                    | To migrate a PostgreSQL database, connect to your database and run the following:                                                                                |
|                                                    |                                                                                                                                                                  |
|                                                    | ``ALTER TABLE Posts ALTER COLUMN Message TYPE VARCHAR(65535);``                                                                                                  |
|                                                    |                                                                                                                                                                  |
|                                                    | Restart your Mattermost instances.                                                                                                                               |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Deployments on Enterprise E20 will need to enable ``RunJobs`` in the ``config.json`` and allow the permissions migration to complete before using :doc:`Team     |
|                                                    | Override Schemes </administration-guide/onboard/advanced-permissions>`.                                                                                          |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v4.10.0                                            | Old email invitation links will no longer work due to a bug fix where teams could be re-joined via the link.                                                     |
|                                                    | Team invite links copied from the Team Invite Link dialog, password reset links and email verification links are not affected and are still valid.               |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Server logs written to **System Console > Logs** and to the ``mattermost.log`` file specified in **System Console > Logging > File Log Directory**               |
|                                                    | now use JSON formatting. If you have built a tool that parses the server logs and sends them to an external system, make sure it supports the JSON format.       |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Team icons with transparency will be filled with a white background in the Team sidebar.                                                                         |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Those servers with SAML authentication enabled should upgrade during non-peak hours. SAML email addresses are migrated to lowercase to prevent login issues,     |
|                                                    | which could result in longer than usual upgrade time.                                                                                                            |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | If you use PostgreSQL database and the password contains special characters (e.g. ``[]``), escape them in your password, e.g., xxx[]xxx will be xxx%5B%5Dxxx.    |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v4.9.0                                             | To improve the production use of Mattermost with Docker, the Docker image is now running a as non-root user and listening on port 8000. Please read the          |
|                                                    | `upgrade instructions <https://github.com/mattermost/mattermost-docker#upgrading-mattermost-to-49>`__ for important changes to existing installations.           |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Several configuration settings have been migrated to roles in the database and changing their ``config.json`` values no longer takes effect. These permissions   |
|                                                    | can still be modified by their respective System Console settings as before. The affected ``config.json`` settings are:                                          |
|                                                    |                                                                                                                                                                  |
|                                                    | - ``RestrictPublicChannelManagement``,                                                                                                                           |
|                                                    | - ``RestrictPrivateChannelManagement``,                                                                                                                          |
|                                                    | - ``RestrictPublicChannelCreation``,                                                                                                                             |
|                                                    | - ``RestrictPrivateChannelCreation``,                                                                                                                            |
|                                                    | - ``RestrictPublicChannelDeletion``,                                                                                                                             |
|                                                    | - ``RestrictPrivateChannelDeletion``,                                                                                                                            |
|                                                    | - ``RestrictPrivateChannelManageMembers``,                                                                                                                       |
|                                                    | - ``EnableTeamCreation``,                                                                                                                                        |
|                                                    | - ``EnableOnlyAdminIntegrations``,                                                                                                                               |
|                                                    | - ``RestrictPostDelete``,                                                                                                                                        |
|                                                    | - ``AllowEditPost``,                                                                                                                                             |
|                                                    | - ``RestrictTeamInvite``,                                                                                                                                        |
|                                                    | - ``RestrictCustomEmojiCreation``.                                                                                                                               |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | The behavior of the ``config.json`` setting ``PostEditTimeLimit`` has been updated to accommodate the migration to a roles based permission system.              |
|                                                    | When post editing is permitted, set ``"PostEditTimeLimit": -1`` to allow editing anytime, or set ``"PostEditTimeLimit"`` to a positive integer to restrict       |
|                                                    | editing time in seconds. If post editing is disabled, this setting does not apply.                                                                               |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | If using Let's Encrypt without a proxy server, the server will fail to start with an error message unless the :ref:`Forward80To443                               |
|                                                    | <administration-guide/configure/environment-configuration-settings:forward port 80 to 443>` ``config.json`` setting is set to ``true``.                          |
|                                                    |                                                                                                                                                                  |
|                                                    | If forwarding port 80 to 443, the server will fail to start with an error message unless the :ref:`ListenAddress                                                 |
|                                                    | <administration-guide/configure/environment-configuration-settings:web server listen address>` ``config.json`` setting is set to listen on port 443.             |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v4.6.2                                             | If using Let's Encrypt without a proxy server, forward port 80 through a firewall, with the :ref:`Forward80To443                                                 |
|                                                    | <administration-guide/configure/environment-configuration-settings:forward port 80 to 443>` ``config.json`` setting set to ``true`` to complete the Let's        |
|                                                    | Encrypt certification.                                                                                                                                           |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v4.4.0                                             | Composite database indexes were added to the ``Posts`` table. This may lead to longer upgrade times for servers with more than one million messages.             |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | LDAP sync now depends on email. Make sure all users on your AD/LDAP server have an email address or that their account is deactivated in Mattermost.             |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v4.2.0                                             | Mattermost now handles multiple content types for integrations, including plaintext content type. If your integration suddenly prints the JSON payload data      |
|                                                    | instead of rendering the generated message, make sure your integration is returning the ``application/json`` content-type to retain previous behavior.           |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | By default, user-supplied URLs such as those used for Open Graph metadata, webhooks, or slash commands will no longer be allowed to connect to reserved IP       |
|                                                    | addresses including loopback or link-local addresses used for internal networks.                                                                                 |
|                                                    |                                                                                                                                                                  |
|                                                    | This change may cause private integrations to break in testing environments, which may point to a URL such as http://127.0.0.1:1021/my-command.                  |
|                                                    |                                                                                                                                                                  |
|                                                    | If you point private integrations to such URLs, you may whitelist such domains, IP addresses, or CIDR notations via the                                          |
|                                                    | :ref:`Allowed Untrusted Internal Connections <administration-guide/configure/environment-configuration-settings:allow untrusted internal connections>`           |
|                                                    | configuration setting in your local environment. Although not recommended, you may also whitelist the addresses in your production environments. See             |
|                                                    | :ref:`documentation to learn more <administration-guide/configure/environment-configuration-settings:allow untrusted internal connections>`.                     |
|                                                    |                                                                                                                                                                  |
|                                                    | Push notification, OAuth 2.0 and WebRTC server URLs are trusted and not affected by this setting.                                                                |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Uploaded file attachments are now grouped by day and stored in ``/data/<date-of-upload-as-YYYYMMDD>/teams/...`` of your file storage system.                     |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Mattermost `/platform`` repo has been separated to ``/mattermost-webapp`` and ``/mattermost-server``. This may affect you if you have a private fork of the      |
|                                                    | ``/platform`` repo. `More details here <https://forum.mattermost.com/t/mattermost-separating-platform-into-two-repositories-on-september-6th/3708>`__.           |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v4.0.0                                             | (High Availability only)                                                                                                                                         |
|                                                    |                                                                                                                                                                  |
|                                                    | You must manually add new items to the ``ClusterSettings`` section of your existing ``config.json``.                                                             |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v3.9.0                                             | Old email invitation links, password reset links, and email verification links will no longer work due to a security change.                                     |
|                                                    | Team invite links copied from the Team Invite Link dialog are not affected and are still valid.                                                                  |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v3.8.0                                             | A change is required in the proxy configuration.                                                                                                                 |
|                                                    | If you’re using NGINX:                                                                                                                                           |
|                                                    |                                                                                                                                                                  |
|                                                    | 1. Open the NGINX configuration file as root. The file is usually ``/etc/nginx/sites-available/mattermost`` but might be different on your system.               |
|                                                    | 2. Locate the line: ``location /api/v3/users/websocket {``                                                                                                       |
|                                                    | 3. Replace the line with ``location ~ /api/v[0-9]+/(users/)?websocket$ {``                                                                                       |
|                                                    |                                                                                                                                                                  |
|                                                    | If you are using a proxy other than NGINX, make the equivalent change to that proxy's configuration.                                                             |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | You need to verify settings in the System Console due to a security-related change.                                                                              |
|                                                    |                                                                                                                                                                  |
|                                                    | 1. Go to the the GENERAL section of the System Console                                                                                                           |
|                                                    | 2. Click **Logging**                                                                                                                                             |
|                                                    | 3. Make sure that the **File Log Directory** field is either empty or has a directory path only. It must not have a filename as part of the path.                |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | Backwards compatibility with the old CLI tool was removed. If you have any scripts that rely on the old CLI, they must be revised to use the                     |
|                                                    | :doc:`new CLI  </administration-guide/manage/command-line-tools>`.                                                                                               |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v3.6.0                                             | Update the maximum number of files that can be open.                                                                                                             |
|                                                    |                                                                                                                                                                  |
|                                                    | On RHEL6 and Ubuntu 14.04:                                                                                                                                       |
|                                                    |   - Verify that the line ``limit nofile 50000 50000`` is included in the ``/etc/init/mattermost.conf`` file.                                                     |
|                                                    | On RHEL7 and Ubuntu 16.04:                                                                                                                                       |
|                                                    |   - Verify that the line ``LimitNOFILE=49152`` is included in the ``/etc/systemd/system/mattermost.service`` file.                                               |
|                                                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                    | (Enterprise Only)                                                                                                                                                |
|                                                    |                                                                                                                                                                  |
|                                                    | Previous ``config.json`` values for restricting Public and Private channel management will be used as the default values for new settings for restricting        |
|                                                    | Public and Private channel creation and deletion.                                                                                                                |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| v3.4.0                                             | If public links are enabled, existing public links will no longer be valid. This is because in earlier versions, existing public links were not invalidated      |
|                                                    | when the Public Link Salt was regenerated. You must update any place where you have published these links.                                                       |
+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _000141_add_remoteid_channelid_to_post_acknowledgements.down.sql: https://github.com/mattermost/mattermost/blob/release-10.10/server/channels/db/migrations/postgres/000141_add_remoteid_channelid_to_post_acknowledgements.down.sql
.. _000141_add_remoteid_channelid_to_post_acknowledgements.up.sql: https://github.com/mattermost/mattermost/blob/release-10.10/server/channels/db/migrations/postgres/000141_add_remoteid_channelid_to_post_acknowledgements.up.sql

Additional upgrade notes
------------------------

.. note::

  - Upgrading the Microsoft Teams Calling plugin to v2.0.0 requires users to reconnect their accounts.
  - Mattermost plugins built with Go versions 1.22.0 and 1.22.1 do not work. Plugin developers should use Go 1.22.2 or newer instead.
  - Keybase has stopped serving Mattermost's Ubuntu repository signing key. If you were using it, update your installation scripts to retrieve the key as mentioned in our :doc:`Linux deployment documentation </deployment-guide/server/deploy-linux>`.
  - We recommend avoiding the use of MySQL 8.0.22 as it contains an `issue with JSON column types <https://bugs.mysql.com/bug.php?id=101284>`_ changing string values to integers which is preventing Mattermost from working properly.
  - When upgrading to Mattermost 7.x from a 5.x release, upgrade to 5.37.10 first before attempting the v7.x upgrade.
  - SQL queries for related schema changes below are **automatically executed** during the Mattermost server upgrade process. **You don't need to run these queries manually**. These SQL queries are provided to help you understand what database changes will occur during the upgrade, and for cases where you prefer to reduce downtime by pre-applying schema changes.
